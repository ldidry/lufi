var lt=Object.create;var _e=Object.defineProperty;var dt=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,yt=Object.prototype.hasOwnProperty;var wt=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Et=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),vt=(e,t)=>{for(var r in t)_e(e,r,{get:t[r],enumerable:!0})},gt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of pt(t))!yt.call(e,o)&&o!==r&&_e(e,o,{get:()=>t[o],enumerable:!(n=dt(t,o))||n.enumerable});return e};var At=(e,t,r)=>(r=e!=null?lt(mt(e)):{},gt(t||!e||!e.__esModule?_e(r,"default",{value:e,enumerable:!0}):r,e));var Ye=Et((Ur,Y)=>{"use strict";var a={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};a.cipher.aes=function(e){this.w[0][0][0]||this.C();var t,r,n,o,i=this.w[0][4],s=this.w[1];t=e.length;var c=1;if(t!==4&&t!==6&&t!==8)throw new a.exception.invalid("invalid aes key size");for(this.b=[n=e.slice(0),o=[]],e=t;e<4*t+28;e++)r=n[e-1],(e%t===0||t===8&&e%t===4)&&(r=i[r>>>24]<<24^i[r>>16&255]<<16^i[r>>8&255]<<8^i[r&255],e%t===0&&(r=r<<8^r>>>24^c<<24,c=c<<1^283*(c>>7))),n[e]=n[e-t]^r;for(t=0;e;t++,e--)r=n[t&3?e:e-4],o[t]=4>=e||4>t?r:s[0][i[r>>>24]]^s[1][i[r>>16&255]]^s[2][i[r>>8&255]]^s[3][i[r&255]]};a.cipher.aes.prototype={encrypt:function(e){return Qe(this,e,0)},decrypt:function(e){return Qe(this,e,1)},w:[[[],[],[],[],[]],[[],[],[],[],[]]],C:function(){var e=this.w[0],t=this.w[1],r=e[4],n=t[4],o,i,s,c=[],h=[],u,f,l,d;for(o=0;256>o;o++)h[(c[o]=o<<1^283*(o>>7))^o]=o;for(i=s=0;!r[i];i^=u||1,s=h[s]||1)for(l=s^s<<1^s<<2^s<<3^s<<4,l=l>>8^l&255^99,r[i]=l,n[l]=i,f=c[o=c[u=c[i]]],d=16843009*f^65537*o^257*u^16843008*i,f=257*c[l]^16843008*l,o=0;4>o;o++)e[o][i]=f=f<<24^f>>>8,t[o][l]=d=d<<24^d>>>8;for(o=0;5>o;o++)e[o]=e[o].slice(0),t[o]=t[o].slice(0)}};function Qe(e,t,r){if(t.length!==4)throw new a.exception.invalid("invalid aes block size");var n=e.b[r],o=t[0]^n[0],i=t[r?3:1]^n[1],s=t[2]^n[2];t=t[r?1:3]^n[3];var c,h,u,f=n.length/4-2,l,d=4,m=[0,0,0,0];c=e.w[r],e=c[0];var g=c[1],I=c[2],T=c[3],W=c[4];for(l=0;l<f;l++)c=e[o>>>24]^g[i>>16&255]^I[s>>8&255]^T[t&255]^n[d],h=e[i>>>24]^g[s>>16&255]^I[t>>8&255]^T[o&255]^n[d+1],u=e[s>>>24]^g[t>>16&255]^I[o>>8&255]^T[i&255]^n[d+2],t=e[t>>>24]^g[o>>16&255]^I[i>>8&255]^T[s&255]^n[d+3],d+=4,o=c,i=h,s=u;for(l=0;4>l;l++)m[r?3&-l:l]=W[o>>>24]<<24^W[i>>16&255]<<16^W[s>>8&255]<<8^W[t&255]^n[d++],c=o,o=i,i=s,s=t,t=c;return m}a.bitArray={bitSlice:function(e,t,r){return e=a.bitArray.Y(e.slice(t/32),32-(t&31)).slice(1),r===void 0?e:a.bitArray.clamp(e,r-t)},extract:function(e,t,r){var n=Math.floor(-t-r&31);return((t+r-1^t)&-32?e[t/32|0]<<32-n^e[t/32+1|0]>>>n:e[t/32|0]>>>n)&(1<<r)-1},concat:function(e,t){if(e.length===0||t.length===0)return e.concat(t);var r=e[e.length-1],n=a.bitArray.getPartial(r);return n===32?e.concat(t):a.bitArray.Y(t,n,r|0,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return t===0?0:32*(t-1)+a.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t=t&31,0<r&&t&&(e[r-1]=a.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return e===32?t:(r?t|0:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(a.bitArray.bitLength(e)!==a.bitArray.bitLength(t))return!1;var r=0,n;for(n=0;n<e.length;n++)r|=e[n]^t[n];return r===0},Y:function(e,t,r,n){var o;for(o=0,n===void 0&&(n=[]);32<=t;t-=32)n.push(r),r=0;if(t===0)return n.concat(e);for(o=0;o<e.length;o++)n.push(r|e[o]>>>t),r=e[o]<<32-t;return o=e.length?e[e.length-1]:0,e=a.bitArray.getPartial(o),n.push(a.bitArray.partial(t+e&31,32<t+e?r:n.pop(),1)),n},P:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,r;for(t=0;t<e.length;++t)r=e[t],e[t]=r>>>24|r>>>8&65280|(r&65280)<<8|r<<24;return e}};a.codec.utf8String={fromBits:function(e){var t="",r=a.bitArray.bitLength(e),n,o;for(n=0;n<r/8;n++)(n&3)===0&&(o=e[n/4]),t+=String.fromCharCode(o>>>8>>>8>>>8),o<<=8;return decodeURIComponent(escape(t))},toBits:function(e){e=unescape(encodeURIComponent(e));var t=[],r,n=0;for(r=0;r<e.length;r++)n=n<<8|e.charCodeAt(r),(r&3)===3&&(t.push(n),n=0);return r&3&&t.push(a.bitArray.partial(8*(r&3),n)),t}};a.codec.hex={fromBits:function(e){var t="",r;for(r=0;r<e.length;r++)t+=((e[r]|0)+0xf00000000000).toString(16).substr(4);return t.substr(0,a.bitArray.bitLength(e)/4)},toBits:function(e){var t,r=[],n;for(e=e.replace(/\s|0x/g,""),n=e.length,e=e+"00000000",t=0;t<e.length;t+=8)r.push(parseInt(e.substr(t,8),16)^0);return a.bitArray.clamp(r,4*n)}};a.codec.base64={S:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,r){var n="",o=0,i=a.codec.base64.S,s=0,c=a.bitArray.bitLength(e);for(r&&(i=i.substr(0,62)+"-_"),r=0;6*n.length<c;)n+=i.charAt((s^e[r]>>>o)>>>26),6>o?(s=e[r]<<6-o,o+=26,r++):(s<<=6,o-=6);for(;n.length&3&&!t;)n+="=";return n},toBits:function(e,t){e=e.replace(/\s|=/g,"");var r=[],n,o=0,i=a.codec.base64.S,s=0,c;for(t&&(i=i.substr(0,62)+"-_"),n=0;n<e.length;n++){if(c=i.indexOf(e.charAt(n)),0>c)throw new a.exception.invalid("this isn't base64!");26<o?(o-=26,r.push(s^c>>>o),s=c<<32-o):(o+=6,s^=c<<32-o)}return o&56&&r.push(a.bitArray.partial(o&56,s,1)),r}};a.codec.base64url={fromBits:function(e){return a.codec.base64.fromBits(e,1,1)},toBits:function(e){return a.codec.base64.toBits(e,1)}};a.hash.sha256=function(e){this.b[0]||this.C(),e?(this.g=e.g.slice(0),this.f=e.f.slice(0),this.c=e.c):this.reset()};a.hash.sha256.hash=function(e){return new a.hash.sha256().update(e).finalize()};a.hash.sha256.prototype={blockSize:512,reset:function(){return this.g=this.o.slice(0),this.f=[],this.c=0,this},update:function(e){typeof e=="string"&&(e=a.codec.utf8String.toBits(e));var t,r=this.f=a.bitArray.concat(this.f,e);if(t=this.c,e=this.c=t+a.bitArray.bitLength(e),9007199254740991<e)throw new a.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var n=new Uint32Array(r),o=0;for(t=512+t-(512+t&511);t<=e;t+=512)this.l(n.subarray(16*o,16*(o+1))),o+=1;r.splice(0,16*o)}else for(t=512+t-(512+t&511);t<=e;t+=512)this.l(r.splice(0,16));return this},finalize:function(){var e,r=this.f,t=this.g,r=a.bitArray.concat(r,[a.bitArray.partial(1,1)]);for(e=r.length+2;e&15;e++)r.push(0);for(r.push(Math.floor(this.c/4294967296)),r.push(this.c|0);r.length;)this.l(r.splice(0,16));return this.reset(),t},o:[],b:[],C:function(){function e(i){return 4294967296*(i-Math.floor(i))|0}for(var t=0,r=2,n,o;64>t;r++){for(o=!0,n=2;n*n<=r;n++)if(r%n===0){o=!1;break}o&&(8>t&&(this.o[t]=e(Math.pow(r,.5))),this.b[t]=e(Math.pow(r,1/3)),t++)}},l:function(e){var t,r,n,o=this.g,i=this.b,s=o[0],c=o[1],h=o[2],u=o[3],f=o[4],l=o[5],d=o[6],m=o[7];for(t=0;64>t;t++)16>t?r=e[t]:(r=e[t+1&15],n=e[t+14&15],r=e[t&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+e[t&15]+e[t+9&15]|0),r=r+m+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(d^f&(l^d))+i[t],m=d,d=l,l=f,f=u+r|0,u=h,h=c,c=s,s=r+(c&h^u&(c^h))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;o[0]=o[0]+s|0,o[1]=o[1]+c|0,o[2]=o[2]+h|0,o[3]=o[3]+u|0,o[4]=o[4]+f|0,o[5]=o[5]+l|0,o[6]=o[6]+d|0,o[7]=o[7]+m|0}};a.hash.sha512=function(e){this.b[0]||this.C(),e?(this.g=e.g.slice(0),this.f=e.f.slice(0),this.c=e.c):this.reset()};a.hash.sha512.hash=function(e){return new a.hash.sha512().update(e).finalize()};a.hash.sha512.prototype={blockSize:1024,reset:function(){return this.g=this.o.slice(0),this.f=[],this.c=0,this},update:function(e){typeof e=="string"&&(e=a.codec.utf8String.toBits(e));var t,r=this.f=a.bitArray.concat(this.f,e);if(t=this.c,e=this.c=t+a.bitArray.bitLength(e),9007199254740991<e)throw new a.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var n=new Uint32Array(r),o=0;for(t=1024+t-(1024+t&1023);t<=e;t+=1024)this.l(n.subarray(32*o,32*(o+1))),o+=1;r.splice(0,32*o)}else for(t=1024+t-(1024+t&1023);t<=e;t+=1024)this.l(r.splice(0,32));return this},finalize:function(){var e,r=this.f,t=this.g,r=a.bitArray.concat(r,[a.bitArray.partial(1,1)]);for(e=r.length+4;e&31;e++)r.push(0);for(r.push(0),r.push(0),r.push(Math.floor(this.c/4294967296)),r.push(this.c|0);r.length;)this.l(r.splice(0,32));return this.reset(),t},o:[],ia:[12372232,13281083,9762859,1914609,15106769,4090911,4308331,8266105],b:[],ka:[2666018,15689165,5061423,9034684,4764984,380953,1658779,7176472,197186,7368638,14987916,16757986,8096111,1480369,13046325,6891156,15813330,5187043,9229749,11312229,2818677,10937475,4324308,1135541,6741931,11809296,16458047,15666916,11046850,698149,229999,945776,13774844,2541862,12856045,9810911,11494366,7844520,15576806,8533307,15795044,4337665,16291729,5553712,15684120,6662416,7413802,12308920,13816008,4303699,9366425,10176680,13195875,4295371,6546291,11712675,15708924,1519456,15772530,6568428,6495784,8568297,13007125,7492395,2515356,12632583,14740254,7262584,1535930,13146278,16321966,1853211,294276,13051027,13221564,1051980,4080310,6651434,14088940,4675607],C:function(){function e(s){return 4294967296*(s-Math.floor(s))|0}function t(s){return 1099511627776*(s-Math.floor(s))&255}for(var r=0,n=2,o,i;80>r;n++){for(i=!0,o=2;o*o<=n;o++)if(n%o===0){i=!1;break}i&&(8>r&&(this.o[2*r]=e(Math.pow(n,.5)),this.o[2*r+1]=t(Math.pow(n,.5))<<24|this.ia[r]),this.b[2*r]=e(Math.pow(n,1/3)),this.b[2*r+1]=t(Math.pow(n,1/3))<<24|this.ka[r],r++)}},l:function(e){var t,r,n=this.g,o=this.b,i=n[0],s=n[1],c=n[2],h=n[3],u=n[4],f=n[5],l=n[6],d=n[7],m=n[8],g=n[9],I=n[10],T=n[11],W=n[12],de=n[13],je=n[14],pe=n[15],C;if(typeof Uint32Array<"u"){C=Array(160);for(var D=0;32>D;D++)C[D]=e[D]}else C=e;var D=i,L=s,te=c,K=h,re=u,Q=f,ke=l,ne=d,b=m,k=g,me=I,oe=T,ye=W,ie=de,Se=je,se=pe;for(e=0;80>e;e++){if(16>e)t=C[2*e],r=C[2*e+1];else{r=C[2*(e-15)];var v=C[2*(e-15)+1];t=(v<<31|r>>>1)^(v<<24|r>>>8)^r>>>7;var R=(r<<31|v>>>1)^(r<<24|v>>>8)^(r<<25|v>>>7);r=C[2*(e-2)];var N=C[2*(e-2)+1],v=(N<<13|r>>>19)^(r<<3|N>>>29)^r>>>6,N=(r<<13|N>>>19)^(N<<3|r>>>29)^(r<<26|N>>>6),Pe=C[2*(e-7)],Ie=C[2*(e-16)],ae=C[2*(e-16)+1];r=R+C[2*(e-7)+1],t=t+Pe+(r>>>0<R>>>0?1:0),r+=N,t+=v+(r>>>0<N>>>0?1:0),r+=ae,t+=Ie+(r>>>0<ae>>>0?1:0)}C[2*e]=t|=0,C[2*e+1]=r|=0;var Pe=b&me^~b&ye,He=k&oe^~k&ie,N=D&te^D&re^te&re,ut=L&K^L&Q^K&Q,Ie=(L<<4|D>>>28)^(D<<30|L>>>2)^(D<<25|L>>>7),ae=(D<<4|L>>>28)^(L<<30|D>>>2)^(L<<25|D>>>7),ft=o[2*e],ze=o[2*e+1],v=se+((b<<18|k>>>14)^(b<<14|k>>>18)^(k<<23|b>>>9)),R=Se+((k<<18|b>>>14)^(k<<14|b>>>18)^(b<<23|k>>>9))+(v>>>0<se>>>0?1:0),v=v+He,R=R+(Pe+(v>>>0<He>>>0?1:0)),v=v+ze,R=R+(ft+(v>>>0<ze>>>0?1:0)),v=v+r|0,R=R+(t+(v>>>0<r>>>0?1:0));r=ae+ut,t=Ie+N+(r>>>0<ae>>>0?1:0),Se=ye,se=ie,ye=me,ie=oe,me=b,oe=k,k=ne+v|0,b=ke+R+(k>>>0<ne>>>0?1:0)|0,ke=re,ne=Q,re=te,Q=K,te=D,K=L,L=v+r|0,D=R+t+(L>>>0<v>>>0?1:0)|0}s=n[1]=s+L|0,n[0]=i+D+(s>>>0<L>>>0?1:0)|0,h=n[3]=h+K|0,n[2]=c+te+(h>>>0<K>>>0?1:0)|0,f=n[5]=f+Q|0,n[4]=u+re+(f>>>0<Q>>>0?1:0)|0,d=n[7]=d+ne|0,n[6]=l+ke+(d>>>0<ne>>>0?1:0)|0,g=n[9]=g+k|0,n[8]=m+b+(g>>>0<k>>>0?1:0)|0,T=n[11]=T+oe|0,n[10]=I+me+(T>>>0<oe>>>0?1:0)|0,de=n[13]=de+ie|0,n[12]=W+ye+(de>>>0<ie>>>0?1:0)|0,pe=n[15]=pe+se|0,n[14]=je+Se+(pe>>>0<se>>>0?1:0)|0}};a.mode.ccm={name:"ccm",F:[],listenProgress:function(e){a.mode.ccm.F.push(e)},unListenProgress:function(e){e=a.mode.ccm.F.indexOf(e),-1<e&&a.mode.ccm.F.splice(e,1)},da:function(e){var t=a.mode.ccm.F.slice(),r;for(r=0;r<t.length;r+=1)t[r](e)},encrypt:function(e,t,r,n,o){var i,s=t.slice(0),c=a.bitArray,h=c.bitLength(r)/8,u=c.bitLength(s)/8;if(o=o||64,n=n||[],7>h)throw new a.exception.invalid("ccm: iv must be at least 7 bytes");for(i=2;4>i&&u>>>8*i;i++);return i<15-h&&(i=15-h),r=c.clamp(r,8*(15-i)),t=a.mode.ccm.U(e,t,r,n,o,i),s=a.mode.ccm.V(e,s,r,t,o,i),c.concat(s.data,s.tag)},decrypt:function(e,t,r,n,o){o=o||64,n=n||[];var i=a.bitArray,s=i.bitLength(r)/8,u=i.bitLength(t),c=i.clamp(t,u-o),h=i.bitSlice(t,u-o),u=(u-o)/8;if(7>s)throw new a.exception.invalid("ccm: iv must be at least 7 bytes");for(t=2;4>t&&u>>>8*t;t++);if(t<15-s&&(t=15-s),r=i.clamp(r,8*(15-t)),c=a.mode.ccm.V(e,c,r,h,o,t),e=a.mode.ccm.U(e,c.data,r,n,o,t),!i.equal(c.tag,e))throw new a.exception.corrupt("ccm: tag doesn't match");return c.data},ma:function(e,t,r,n,o,i){var s=[],c=a.bitArray,h=c.P;if(n=[c.partial(8,(t.length?64:0)|n-2<<2|i-1)],n=c.concat(n,r),n[3]|=o,n=e.encrypt(n),t.length)for(r=c.bitLength(t)/8,65279>=r?s=[c.partial(16,r)]:4294967295>=r&&(s=c.concat([c.partial(16,65534)],[r])),s=c.concat(s,t),t=0;t<s.length;t+=4)n=e.encrypt(h(n,s.slice(t,t+4).concat([0,0,0])));return n},U:function(e,t,r,n,o,i){var s=a.bitArray,c=s.P;if(o/=8,o%2||4>o||16<o)throw new a.exception.invalid("ccm: invalid tag length");if(4294967295<n.length||4294967295<t.length)throw new a.exception.bug("ccm: can't deal with 4GiB or more data");for(r=a.mode.ccm.ma(e,n,r,o,s.bitLength(t)/8,i),n=0;n<t.length;n+=4)r=e.encrypt(c(r,t.slice(n,n+4).concat([0,0,0])));return s.clamp(r,8*o)},V:function(e,t,r,n,o,i){var s,c=a.bitArray;s=c.P;var h=t.length,u=c.bitLength(t),f=h/50,l=f;if(r=c.concat([c.partial(8,i-1)],r).concat([0,0,0]).slice(0,4),n=c.bitSlice(s(n,e.encrypt(r)),0,o),!h)return{tag:n,data:[]};for(s=0;s<h;s+=4)s>f&&(a.mode.ccm.da(s/h),f+=l),r[3]++,o=e.encrypt(r),t[s]^=o[0],t[s+1]^=o[1],t[s+2]^=o[2],t[s+3]^=o[3];return{tag:n,data:c.clamp(t,u)}}};a.misc.hmac=function(e,t){this.W=t=t||a.hash.sha256;var r=[[],[]],n,o=t.prototype.blockSize/32;for(this.B=[new t,new t],e.length>o&&(e=t.hash(e)),n=0;n<o;n++)r[0][n]=e[n]^909522486,r[1][n]=e[n]^1549556828;this.B[0].update(r[0]),this.B[1].update(r[1]),this.O=new t(this.B[0])};a.misc.hmac.prototype.encrypt=a.misc.hmac.prototype.mac=function(e){if(this.Z)throw new a.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)};a.misc.hmac.prototype.reset=function(){this.O=new this.W(this.B[0]),this.Z=!1};a.misc.hmac.prototype.update=function(e){this.Z=!0,this.O.update(e)};a.misc.hmac.prototype.digest=function(){var e=this.O.finalize(),e=new this.W(this.B[1]).update(e).finalize();return this.reset(),e};a.misc.pbkdf2=function(e,t,r,n,o){if(r=r||1e4,0>n||0>r)throw new a.exception.invalid("invalid params to pbkdf2");typeof e=="string"&&(e=a.codec.utf8String.toBits(e)),typeof t=="string"&&(t=a.codec.utf8String.toBits(t)),o=o||a.misc.hmac,e=new o(e);var i,s,c,h,u=[],f=a.bitArray;for(h=1;32*u.length<(n||1);h++){for(o=i=e.encrypt(f.concat(t,[h])),s=1;s<r;s++)for(i=e.encrypt(i),c=0;c<i.length;c++)o[c]^=i[c];u=u.concat(o)}return n&&(u=f.clamp(u,n)),u};a.prng=function(e){this.h=[new a.hash.sha256],this.s=[0],this.N=0,this.G={},this.M=0,this.T={},this.X=this.i=this.u=this.fa=0,this.b=[0,0,0,0,0,0,0,0],this.m=[0,0,0,0],this.K=void 0,this.L=e,this.D=!1,this.J={progress:{},seeded:{}},this.A=this.ea=0,this.H=1,this.I=2,this.aa=65536,this.R=[0,48,64,96,128,192,256,384,512,768,1024],this.ba=3e4,this.$=80};a.prng.prototype={randomWords:function(e,t){var r=[],n;n=this.isReady(t);var o;if(n===this.A)throw new a.exception.notReady("generator isn't seeded");if(n&this.I){n=!(n&this.H),o=[];var i=0,s;for(this.X=o[0]=new Date().valueOf()+this.ba,s=0;16>s;s++)o.push(4294967296*Math.random()|0);for(s=0;s<this.h.length&&(o=o.concat(this.h[s].finalize()),i+=this.s[s],this.s[s]=0,n||!(this.N&1<<s));s++);for(this.N>=1<<this.h.length&&(this.h.push(new a.hash.sha256),this.s.push(0)),this.i-=i,i>this.u&&(this.u=i),this.N++,this.b=a.hash.sha256.hash(this.b.concat(o)),this.K=new a.cipher.aes(this.b),n=0;4>n&&(this.m[n]=this.m[n]+1|0,!this.m[n]);n++);}for(n=0;n<e;n+=4)(n+1)%this.aa===0&&Ze(this),o=Ue(this),r.push(o[0],o[1],o[2],o[3]);return Ze(this),r.slice(0,e)},setDefaultParanoia:function(e,t){if(e===0&&t!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new a.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.L=e},addEntropy:function(e,t,r){r=r||"user";var n,o,i=new Date().valueOf(),s=this.G[r],c=this.isReady(),h=0;switch(n=this.T[r],n===void 0&&(n=this.T[r]=this.fa++),s===void 0&&(s=this.G[r]=0),this.G[r]=(this.G[r]+1)%this.h.length,typeof e){case"number":t===void 0&&(t=1),this.h[s].update([n,this.M++,1,t,i,1,e|0]);break;case"object":if(r=Object.prototype.toString.call(e),r==="[object Uint32Array]"){for(o=[],r=0;r<e.length;r++)o.push(e[r]);e=o}else for(r!=="[object Array]"&&(h=1),r=0;r<e.length&&!h;r++)typeof e[r]!="number"&&(h=1);if(!h){if(t===void 0)for(r=t=0;r<e.length;r++)for(o=e[r];0<o;)t++,o=o>>>1;this.h[s].update([n,this.M++,2,t,i,e.length].concat(e))}break;case"string":t===void 0&&(t=e.length),this.h[s].update([n,this.M++,3,t,i,e.length]),this.h[s].update(e);break;default:h=1}if(h)throw new a.exception.bug("random: addEntropy only supports number, array of numbers or string");this.s[s]+=t,this.i+=t,c===this.A&&(this.isReady()!==this.A&&Xe("seeded",Math.max(this.u,this.i)),Xe("progress",this.getProgress()))},isReady:function(e){return e=this.R[e!==void 0?e:this.L],this.u&&this.u>=e?this.s[0]>this.$&&new Date().valueOf()>this.X?this.I|this.H:this.H:this.i>=e?this.I|this.A:this.A},getProgress:function(e){return e=this.R[e||this.L],this.u>=e||this.i>e?1:this.i/e},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:he(this,this.la),mouseCollector:he(this,this.na),keyboardCollector:he(this,this.ja),accelerometerCollector:he(this,this.ca),touchCollector:he(this,this.pa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new a.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(e,t){this.J[e][this.ea++]=t},removeEventListener:function(e,t){var r,n,o=this.J[e],i=[];for(n in o)o.hasOwnProperty(n)&&o[n]===t&&i.push(n);for(r=0;r<i.length;r++)n=i[r],delete o[n]},ja:function(){ce(this,1)},na:function(e){var t,r;try{t=e.x||e.clientX||e.offsetX||0,r=e.y||e.clientY||e.offsetY||0}catch{r=t=0}t!=0&&r!=0&&this.addEntropy([t,r],2,"mouse"),ce(this,0)},pa:function(e){e=e.touches[0]||e.changedTouches[0],this.addEntropy([e.pageX||e.clientX,e.pageY||e.clientY],1,"touch"),ce(this,0)},la:function(){ce(this,2)},ca:function(e){if(e=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z,window.orientation){var t=window.orientation;typeof t=="number"&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),ce(this,0)}};function Xe(e,t){var r,n=a.random.J[e],o=[];for(r in n)n.hasOwnProperty(r)&&o.push(n[r]);for(r=0;r<o.length;r++)o[r](t)}function ce(e,t){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?e.addEntropy(window.performance.now(),t,"loadtime"):e.addEntropy(new Date().valueOf(),t,"loadtime")}function Ze(e){e.b=Ue(e).concat(Ue(e)),e.K=new a.cipher.aes(e.b)}function Ue(e){for(var t=0;4>t&&(e.m[t]=e.m[t]+1|0,!e.m[t]);t++);return e.K.encrypt(e.m)}function he(e,t){return function(){t.apply(e,arguments)}}a.random=new a.prng(6);e:try{if(ge=typeof Y<"u"&&Y.exports){try{Ae=wt("node:crypto")}catch{Ae=null}ge=ve=Ae}if(ge&&ve.randomBytes)ue=ve.randomBytes(128),ue=new Uint32Array(new Uint8Array(ue).buffer),a.random.addEntropy(ue,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(fe=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(fe);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(fe);else break e;a.random.addEntropy(fe,1024,"crypto['getRandomValues']")}}catch(e){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(e))}var ue,ve,fe,ge,Ae;a.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ha:function(e,t,r,n){r=r||{},n=n||{};var o=a.json,i=o.j({iv:a.random.randomWords(4,0)},o.defaults),s;if(o.j(i,r),r=i.adata,typeof i.salt=="string"&&(i.salt=a.codec.base64.toBits(i.salt)),typeof i.iv=="string"&&(i.iv=a.codec.base64.toBits(i.iv)),!a.mode[i.mode]||!a.cipher[i.cipher]||typeof e=="string"&&100>=i.iter||i.ts!==64&&i.ts!==96&&i.ts!==128||i.ks!==128&&i.ks!==192&&i.ks!==256||2>i.iv.length||4<i.iv.length)throw new a.exception.invalid("json encrypt: invalid parameters");return typeof e=="string"?(s=a.misc.cachedPbkdf2(e,i),e=s.key.slice(0,i.ks/32),i.salt=s.salt):a.ecc&&e instanceof a.ecc.elGamal.publicKey&&(s=e.kem(),i.kemtag=s.tag,e=s.key.slice(0,i.ks/32)),typeof t=="string"&&(t=a.codec.utf8String.toBits(t)),typeof r=="string"&&(i.adata=r=a.codec.utf8String.toBits(r)),s=new a.cipher[i.cipher](e),o.j(n,i),n.key=e,i.ct=i.mode==="ccm"&&a.arrayBuffer&&a.arrayBuffer.ccm&&t instanceof ArrayBuffer?a.arrayBuffer.ccm.encrypt(s,t,i.iv,r,i.ts):a.mode[i.mode].encrypt(s,t,i.iv,r,i.ts),i},encrypt:function(e,t,r,n){var o=a.json,i=o.ha.apply(o,arguments);return o.encode(i)},ga:function(e,t,r,n){r=r||{},n=n||{};var o=a.json;t=o.j(o.j(o.j({},o.defaults),t),r,!0);var i,s;if(i=t.adata,typeof t.salt=="string"&&(t.salt=a.codec.base64.toBits(t.salt)),typeof t.iv=="string"&&(t.iv=a.codec.base64.toBits(t.iv)),!a.mode[t.mode]||!a.cipher[t.cipher]||typeof e=="string"&&100>=t.iter||t.ts!==64&&t.ts!==96&&t.ts!==128||t.ks!==128&&t.ks!==192&&t.ks!==256||!t.iv||2>t.iv.length||4<t.iv.length)throw new a.exception.invalid("json decrypt: invalid parameters");return typeof e=="string"?(s=a.misc.cachedPbkdf2(e,t),e=s.key.slice(0,t.ks/32),t.salt=s.salt):a.ecc&&e instanceof a.ecc.elGamal.secretKey&&(e=e.unkem(a.codec.base64.toBits(t.kemtag)).slice(0,t.ks/32)),typeof i=="string"&&(i=a.codec.utf8String.toBits(i)),s=new a.cipher[t.cipher](e),i=t.mode==="ccm"&&a.arrayBuffer&&a.arrayBuffer.ccm&&t.ct instanceof ArrayBuffer?a.arrayBuffer.ccm.decrypt(s,t.ct,t.iv,t.tag,i,t.ts):a.mode[t.mode].decrypt(s,t.ct,t.iv,i,t.ts),o.j(n,t),n.key=e,r.raw===1?i:a.codec.utf8String.fromBits(i)},decrypt:function(e,t,r,n){var o=a.json;return o.ga(e,o.decode(t),r,n)},encode:function(e){var t,r="{",n="";for(t in e)if(e.hasOwnProperty(t)){if(!t.match(/^[a-z0-9]+$/i))throw new a.exception.invalid("json encode: invalid property name");switch(r+=n+'"'+t+'":',n=",",typeof e[t]){case"number":case"boolean":r+=e[t];break;case"string":r+='"'+escape(e[t])+'"';break;case"object":r+='"'+a.codec.base64.fromBits(e[t],0)+'"';break;default:throw new a.exception.bug("json encode: unsupported type")}}return r+"}"},decode:function(e){if(e=e.replace(/\s/g,""),!e.match(/^\{.*\}$/))throw new a.exception.invalid("json decode: this isn't json!");e=e.replace(/^\{|\}$/g,"").split(/,/);var t={},r,n;for(r=0;r<e.length;r++){if(!(n=e[r].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new a.exception.invalid("json decode: this isn't json!");n[3]!=null?t[n[2]]=parseInt(n[3],10):n[4]!=null?t[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?a.codec.base64.toBits(n[4]):unescape(n[4]):n[5]!=null&&(t[n[2]]=n[5]==="true")}return t},j:function(e,t,r){if(e===void 0&&(e={}),t===void 0)return e;for(var n in t)if(t.hasOwnProperty(n)){if(r&&e[n]!==void 0&&e[n]!==t[n])throw new a.exception.invalid("required parameter overridden");e[n]=t[n]}return e},ra:function(e,t){var r={},n;for(n in e)e.hasOwnProperty(n)&&e[n]!==t[n]&&(r[n]=e[n]);return r},qa:function(e,t){var r={},n;for(n=0;n<t.length;n++)e[t[n]]!==void 0&&(r[t[n]]=e[t[n]]);return r}};a.encrypt=a.json.encrypt;a.decrypt=a.json.decrypt;a.misc.oa={};a.misc.cachedPbkdf2=function(e,t){var r=a.misc.oa,n;return t=t||{},n=t.iter||1e3,r=r[e]=r[e]||{},n=r[n]=r[n]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):a.random.randomWords(2,0)},r=t.salt===void 0?n.firstSalt:t.salt,n[r]=n[r]||a.misc.pbkdf2(e,r,t.iter),{key:n[r].slice(0),salt:r.slice(0)}};typeof Y<"u"&&Y.exports&&(Y.exports=a);typeof define=="function"&&define([],function(){return a})});var ht={};vt(ht,{addFilesToArchive:()=>it,cancel:()=>Ft,compress:()=>st,decompress:()=>Bt,download:()=>Nt,events:()=>Ne,getFileIndexInQueue:()=>qt,infos:()=>jt,pause:()=>Ht,remove:()=>zt,resume:()=>Wt,upload:()=>Vt});var Dt={withStackTrace:!1},Ve=(e,t,r=Dt)=>{let n=t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},o=r.withStackTrace?new Error().stack:void 0;return{data:n,message:e,stack:o}};function J(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function c(f){try{u(n.next(f))}catch(l){s(l)}}function h(f){try{u(n.throw(f))}catch(l){s(l)}}function u(f){f.done?i(f.value):o(f.value).then(c,h)}u((n=n.apply(e,t||[])).next())})}function We(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function j(e){return this instanceof j?(this.v=e,this):new j(e)}function Ge(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(m){return function(g){return Promise.resolve(g).then(m,l)}}function c(m,g){n[m]&&(o[m]=function(I){return new Promise(function(T,W){i.push([m,I,T,W])>1||h(m,I)})},g&&(o[m]=g(o[m])))}function h(m,g){try{u(n[m](g))}catch(I){d(i[0][3],I)}}function u(m){m.value instanceof j?Promise.resolve(m.value.v).then(f,l):d(i[0][2],m)}function f(m){h("next",m)}function l(m){h("throw",m)}function d(m,g){m(g),i.shift(),i.length&&h(i[0][0],i[0][1])}}function xt(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,i){t[o]=e[o]?function(s){return(r=!r)?{value:j(e[o](s)),done:!1}:i?i(s):s}:i}}function Ot(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof We=="function"?We(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(c,h){s=e[i](s),o(c,h,s.done,s.value)})}}function o(i,s,c,h){Promise.resolve(h).then(function(u){i({value:u,done:c})},s)}}var y=class e{constructor(t){this._promise=t}static fromSafePromise(t){let r=t.then(n=>new S(n));return new e(r)}static fromPromise(t,r){let n=t.then(o=>new S(o)).catch(o=>new P(r(o)));return new e(n)}static fromThrowable(t,r){return(...n)=>new e(J(this,void 0,void 0,function*(){try{return new S(yield t(...n))}catch(o){return new P(r?r(o):o)}}))}static combine(t){return Ct(t)}static combineWithAllErrors(t){return Lt(t)}map(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){return r.isErr()?new P(r.error):new S(yield t(r.value))})))}andThrough(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){if(r.isErr())return new P(r.error);let n=yield t(r.value);return n.isErr()?new P(n.error):new S(r.value)})))}andTee(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){if(r.isErr())return new P(r.error);try{yield t(r.value)}catch{}return new S(r.value)})))}orTee(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){if(r.isOk())return new S(r.value);try{yield t(r.error)}catch{}return new P(r.error)})))}mapErr(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){return r.isOk()?new S(r.value):new P(yield t(r.error))})))}andThen(t){return new e(this._promise.then(r=>{if(r.isErr())return new P(r.error);let n=t(r.value);return n instanceof e?n._promise:n}))}orElse(t){return new e(this._promise.then(r=>J(this,void 0,void 0,function*(){return r.isErr()?t(r.error):new S(r.value)})))}match(t,r){return this._promise.then(n=>n.match(t,r))}unwrapOr(t){return this._promise.then(r=>r.unwrapOr(t))}safeUnwrap(){return Ge(this,arguments,function*(){return yield j(yield j(yield*xt(Ot(yield j(this._promise.then(r=>r.safeUnwrap()))))))})}then(t,r){return this._promise.then(t,r)}[Symbol.asyncIterator](){return Ge(this,arguments,function*(){let r=yield j(this._promise);return r.isErr()&&(yield yield j(A(r.error))),yield j(r.value)})}};function w(e){return new y(Promise.resolve(new S(e)))}function A(e){return new y(Promise.resolve(new P(e)))}var Kt=y.fromPromise,Qt=y.fromSafePromise,Xt=y.fromThrowable,$e=e=>{let t=G([]);for(let r of e)if(r.isErr()){t=M(r.error);break}else t.map(n=>n.push(r.value));return t},Ct=e=>y.fromSafePromise(Promise.all(e)).andThen($e),qe=e=>{let t=G([]);for(let r of e)r.isErr()&&t.isErr()?t.error.push(r.error):r.isErr()&&t.isOk()?t=M([r.error]):r.isOk()&&t.isOk()&&t.value.push(r.value);return t},Lt=e=>y.fromSafePromise(Promise.all(e)).andThen(qe),Te;(function(e){function t(o,i){return(...s)=>{try{let c=o(...s);return G(c)}catch(c){return M(i?i(c):c)}}}e.fromThrowable=t;function r(o){return $e(o)}e.combine=r;function n(o){return qe(o)}e.combineWithAllErrors=n})(Te||(Te={}));function G(e){return new S(e)}function M(e){return new P(e)}var S=class{constructor(t){this.value=t}isOk(){return!0}isErr(){return!this.isOk()}map(t){return G(t(this.value))}mapErr(t){return G(this.value)}andThen(t){return t(this.value)}andThrough(t){return t(this.value).map(r=>this.value)}andTee(t){try{t(this.value)}catch{}return G(this.value)}orTee(t){return G(this.value)}orElse(t){return G(this.value)}asyncAndThen(t){return t(this.value)}asyncAndThrough(t){return t(this.value).map(()=>this.value)}asyncMap(t){return y.fromSafePromise(t(this.value))}unwrapOr(t){return this.value}match(t,r){return t(this.value)}safeUnwrap(){let t=this.value;return function*(){return t}()}_unsafeUnwrap(t){return this.value}_unsafeUnwrapErr(t){throw Ve("Called `_unsafeUnwrapErr` on an Ok",this,t)}*[Symbol.iterator](){return this.value}},P=class{constructor(t){this.error=t}isOk(){return!1}isErr(){return!this.isOk()}map(t){return M(this.error)}mapErr(t){return M(t(this.error))}andThrough(t){return M(this.error)}andTee(t){return M(this.error)}orTee(t){try{t(this.error)}catch{}return M(this.error)}andThen(t){return M(this.error)}orElse(t){return t(this.error)}asyncAndThen(t){return A(this.error)}asyncAndThrough(t){return A(this.error)}asyncMap(t){return A(this.error)}unwrapOr(t){return t}match(t,r){return r(this.error)}safeUnwrap(){let t=this.error;return function*(){throw yield M(t),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(t){throw Ve("Called `_unsafeUnwrap` on an Err",this,t)}_unsafeUnwrapErr(t){return this.error}*[Symbol.iterator](){let t=this;return yield t,t}},Zt=Te.fromThrowable;var X=class extends EventTarget{events=[];constructor(){super()}emit=(t,r)=>(this.dispatchEvent(new CustomEvent(t,{detail:r})),w(void 0));on=(t,r)=>(this.addEventListener(t,r||null),this.events.push({type:t,listener:r||null}),w(void 0));once=(t,r)=>(this.events.find(o=>o.type===t)||this.on(t,r),w(void 0))};var V=function(e){return e[e.CANCELED=0]="CANCELED",e[e.COMPLETE=1]="COMPLETE",e[e.FAILED=2]="FAILED",e[e.INITIALIZED=3]="INITIALIZED",e[e.QUEUED=4]="QUEUED",e}({});var H=class e{actionToken="";chunksReady=0;createdAt=0;delay=0;delAtFirstView=!1;keys={client:"",server:""};name="";password="";queueIndex=0;serverUrl;size=0;uploadStatus=V.INITIALIZED;totalChunks=0;type="";zipped=!1;constructor(t,r){this.serverUrl=t,Object.assign(this,r)}downloadUrl(){let t=new URL(this.serverUrl);return new URL(`${t.origin+t.pathname}r/${this.keys.server}#${this.keys.client}`)}removeUrl(){let t=new URL(this.serverUrl);return new URL(`${t.origin+t.pathname}d/${this.keys.server}/${this.actionToken}`)}static fromDownloadUrl(t,r=""){let n=t.pathname.split("r/"),o={client:t.hash.slice(1).split("&")[0],server:n[1]};return new e(t.origin+n[0],{keys:o,password:r})}static fromRemoveUrl(t,r=""){let n=t.pathname.split("d/"),o=n[1].split("/"),i={client:"",server:o[0]};return new e(t.origin+n[0],{keys:i,password:r,actionToken:o[1]})}};var p=function(e){return e.ARCHIVE_ADDED_FILE="ARCHIVE_ADDED_FILE",e.ARCHIVE_RETRIEVED_FILE="ARCHIVE_RETRIEVED_FILE",e.ARCHIVE_CREATED="ARCHIVE_CREATED",e.ARCHIVE_DECOMPRESSED="ARCHIVE_DECOMPRESSED",e.CHUNK_DOWNLOADED="CHUNK_DOWNLOADED",e.CHUNK_UPLOADED="CHUNK_UPLOADED",e.DOWNLOAD_COMPLETE="DOWNLOAD_COMPLETE",e.DOWNLOAD_FAILED="DOWNLOAD_FAILED",e.DOWNLOAD_STARTED="DOWNLOAD_STARTED",e.FILE_REMOVED="FILE_REMOVED",e.FILE_UPDATED="FILE_UPDATED",e.INFOS_RETRIEVED="INFOS_RETRIEVED",e.JOB_PAUSED="JOB_PAUSED",e.JOB_RESUMED="JOB_RESUMED",e.JOB_TERMINATED="JOB_TERMINATED",e.OPERATION_FAILED="OPERATION_FAILED",e.SLICE_STARTED="SLICE_STARTED",e.SOCKET_ONERROR="SOCKET_ONERROR",e.SOCKET_OPENED="SOCKET_OPENED",e.SOCKET_OPERATION_TERMINATED="SOCKET_OPERATION_TERMINATED",e.UPLOAD_CANCELLED="UPLOAD_CANCELLED",e.UPLOAD_COMPLETE="UPLOAD_COMPLETE",e.UPLOAD_FAILED="UPLOAD_FAILED",e.UPLOAD_STARTED="UPLOAD_STARTED",e}({});var U=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.ONGOING=2]="ONGOING",e[e.PAUSED=3]="PAUSED",e}({});var x=class extends Error{context;constructor(t,r={}){let{cause:n,context:o}=r;super(t,{cause:n}),this.name=this.constructor.name,this.context=o}};var we=class extends x{message="Unable to connect. Is the computer able to access the url?"};var Ee=class extends x{message="The server returned an error"};var E=e=>{if(e instanceof Error)return e;let t="[Unable to stringify the thrown value]";try{t=JSON.stringify(e)}catch{}return new Error(t)},Je=e=>{let t=e.href.match(/(.*?)\/?(?:\/[dr]{1}\/|login\/?|files\/?)/),r=t&&t[1]?t[1]:e.origin;return y.fromPromise(fetch(r+"/about/config"),n=>new we(void 0,{cause:E(n)})).andThen(n=>n.ok?y.fromPromise(n.json(),o=>E(o)):A(new Ee(void 0,{context:n.statusText})))},Ke=()=>typeof Deno<"u",be=()=>Ke()||globalThis.isSecureContext||globalThis.location.protocol==="https:",$=e=>Ke()?new URL(`./worker/${e}.ts`,new URL(".",import.meta.url).href):new URL(import.meta.resolve(`./${e!=="encrypt"?`worker/${e}`:e}.js`));var O=function(e){return e[e.CANCEL=0]="CANCEL",e[e.COMPRESS=1]="COMPRESS",e[e.DECOMPRESS=2]="DECOMPRESS",e[e.DOWNLOAD=3]="DOWNLOAD",e[e.INFOS=4]="INFOS",e[e.REMOVE=5]="REMOVE",e[e.UPLOAD=6]="UPLOAD",e}({});var z=class{events=new X;lufiFile;status=U.ONGOING;archiveFile;archiveFiles=[];downloadedFile;worker;isTerminated=!1;constructor(t,r){switch(r){case O.CANCEL:this.worker=new Worker($("cancel"),{type:"module"});break;case O.COMPRESS:this.worker=new Worker($("compress"),{type:"module"});break;case O.DECOMPRESS:this.worker=new Worker($("decompress"),{type:"module"});break;case O.DOWNLOAD:this.worker=new Worker($("download"),{type:"module"});break;case O.INFOS:this.worker=new Worker($("infos"),{type:"module"});break;case O.REMOVE:this.worker=new Worker($("remove"),{type:"module"});break;case O.UPLOAD:this.worker=new Worker($("upload"),{type:"module"});break}this.lufiFile=t,this.events.on(p.JOB_TERMINATED,()=>{this.isTerminated=!0,this.terminate()}),this.events.on(p.OPERATION_FAILED,n=>{this.status=U.FAILED,this.lufiFile.uploadStatus=V.FAILED,this.events.emit(p.JOB_TERMINATED,{error:n.detail.error})}),this.onError(n=>console.error(n.error))}complete=()=>{this.status=U.COMPLETE,this.events.emit(p.JOB_TERMINATED)};hasFailed=()=>this.status===U.FAILED;onError=t=>(this.worker.onerror=r=>{t(r)},this);onMessage=t=>(this.worker.onmessage=r=>{t&&t(r);let n=r.data.event;n&&(n===p.FILE_UPDATED?Object.assign(this.lufiFile,r.data.lufiFile):this.dispatchEvent(n,r.data.error))},this);onMessageError=t=>(this.worker.onmessageerror=r=>{t(r)},this);onProgress=t=>(this.events.on(p.CHUNK_UPLOADED,()=>{t()}),this.events.on(p.CHUNK_DOWNLOADED,()=>{t()}),this);requestMessage=(t,r=[])=>(this.worker.postMessage(t,r),this);terminate=()=>(this.worker.terminate(),this);waitForCompletion=()=>this.isTerminated?this.status===U.COMPLETE?w(this):A(E("Job has failed")):y.fromPromise(new Promise((t,r)=>{this.events.on(p.OPERATION_FAILED,n=>{r(n.detail.error)}),this.events.on(p.JOB_TERMINATED,()=>{this.status===U.COMPLETE&&t(this)})}),t=>E(t));waitForStart=()=>y.fromPromise(new Promise((t,r)=>{this.events.on(p.OPERATION_FAILED,n=>{r(n.detail.error)}),this.events.on(p.UPLOAD_STARTED,()=>{t(this)}),this.events.on(p.DOWNLOAD_STARTED,()=>{t(this)})}),t=>E(t));dispatchEvent=(t,r)=>{this.events.emit(t,{error:r})}};var Re=function(e){return e[e.PAUSE=0]="PAUSE",e[e.PROVIDE_FILE=1]="PROVIDE_FILE",e[e.RESUME=2]="RESUME",e}({});var F=function(e){return e[e.Sjcl=0]="Sjcl",e[e.WebCrypto=1]="WebCrypto",e}({});var Z=class{constructor(t,r){if(!t||t.length!=64)throw Error("Charset must contain 64 characters");this._charset=t,this._noPadding=!!r,this._valid=new RegExp("^["+this._charset.replace("-","\\-")+"]+={0,2}$")}Encode(t){let r=t.byteLength;if(!r)return"";let n=new Uint8Array(t),o="";for(let i=0;i<r;i+=3)o+=this._charset[n[i]>>2]+this._charset[(n[i]&3)<<4|n[i+1]>>4]+this._charset[(n[i+1]&15)<<2|n[i+2]>>6]+this._charset[n[i+2]&63];return r%3==2?(o=o.substring(0,o.length-1),this._noPadding||(o+="=")):r%3==1&&(o=o.substring(0,o.length-2),this._noPadding||(o+="==")),o}Decode(t){if(t=(t||"").replace(/[\s]/g,""),!t)return new ArrayBuffer(0);if(!this._valid.test(t))throw Error("Invalid base64 input sequence");let r=Math.floor(t.length*.75);t[t.length-2]=="="?r-=2:t[t.length-1]=="="&&r--;let n=new Uint8Array(r),o,i,s,c,h=0,u=0;for(;h<t.length*.75;)o=this._charset.indexOf(t.charAt(u++)),i=this._charset.indexOf(t.charAt(u++)),s=this._charset.indexOf(t.charAt(u++)),c=this._charset.indexOf(t.charAt(u++)),n[h++]=o<<2|i>>4,n[h++]=(i&15)<<4|s>>2,n[h++]=(s&3)<<6|c;return n.buffer}};var Pr=new Z("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");var kt=new Z("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",!0);function Me(e){return kt.Encode(e)}var le=At(Ye());var B=class extends x{};var ee=class extends B{message="Unable to hash the provided string"};var et=()=>{try{return w(le.default.codec.base64.fromBits(le.default.random.randomWords(8,10)))}catch(e){return A(new B("Unable to generate key",{cause:E(e)}))}},tt=e=>{try{return w(le.default.codec.hex.fromBits(le.default.hash.sha512.hash(e)))}catch(t){return A(new ee(void 0,{cause:E(t)}))}};var rt=()=>y.fromPromise(new Promise((e,t)=>crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(r=>crypto.subtle.exportKey("raw",r).then(n=>e(Me(n))).catch(n=>{t(new B("Unable to base64 encode the url",{cause:E(n)}))})).catch(r=>t(r))),e=>new B("Unable to generate key",{cause:E(e)})),nt=e=>{let t=async()=>Array.from(new Uint8Array(await crypto.subtle.digest("SHA-512",new TextEncoder().encode(e)))).map(r=>r.toString(16).padStart(2,"0")).join("");return y.fromPromise(t(),r=>new ee(void 0,{cause:E(r)}))};var ot=(e=F.WebCrypto)=>e===F.Sjcl?et():rt(),Fe=(e,t)=>t===F.Sjcl?tt(e):nt(e);var De=class extends x{message="An error occured while downloading the data"};var xe=class extends x{message="An error occured while trying to retrieve server informations"};var _=class extends x{};var Oe=class extends _{message="An error occured while trying to pause the job"};var Ce=class extends _{message="An error occured while trying to resume the job"};var Le=class extends x{message="An error occured while uploading the data"};var Ut=15e5,q={},Ne=new X,Ft=e=>{e.terminate();let t=new z(e.lufiFile,O.CANCEL);return y.fromPromise(new Promise((r,n)=>{t.onMessage(o=>{o.data.event===p.UPLOAD_CANCELLED&&(q[t.lufiFile.keys.client].uploadStatus=V.CANCELED,r(t)),o.data.event===p.OPERATION_FAILED&&n(new _("An error occured while trying to cancel an upload",{cause:o.data.error}))}).requestMessage({args:{lufiFile:t.lufiFile}})}),r=>E(r))},it=(e,t={})=>{let r=async n=>{for(let o of n){let i=o.name.split("/")?.pop()||o.name,s=i.split(".").shift(),c=i.split(".").length>1?`.${i.split(".").pop()}`:"",h=i;if(t[h]!==void 0){let u=1;do h=`${s}(${u})${c}`,u++;while(t[h]!==void 0)}Ne.emit(p.ARCHIVE_ADDED_FILE,{name:h,size:o.size}),t[h]=await o.bytes()}};return y.fromPromise(r(e),n=>E(n)).andThen(()=>w(t))},st=(e,t)=>{let r=new H(""),n=new z(r,O.COMPRESS);return w(n.onMessage(o=>{o.data.event===p.ARCHIVE_CREATED&&(n.archiveFile=new File([o.data.buffer],t,{type:"application/zip"}),n.complete())}).requestMessage({args:{lufiFile:r,archive:{entries:e}}}))},Bt=e=>{let t=new H(""),r=new z(t,O.DECOMPRESS);return w(r.onMessage(n=>{n.data.event===p.ARCHIVE_DECOMPRESSED&&r.complete(),n.data.event===p.ARCHIVE_RETRIEVED_FILE&&r.archiveFiles.push(new File([n.data.file.buffer],n.data.file.path))}).requestMessage({args:{lufiFile:t,archive:{file:e}}}))},at=(e,t)=>t?Je(e).andThen(r=>{if(r.version.tag>"0.07.0"){let n=be()?F.WebCrypto:F.Sjcl;return Fe(t,n).andThen(o=>w(H.fromDownloadUrl(e,o)))}else return w(H.fromDownloadUrl(e,t))}):w(H.fromDownloadUrl(e)),Nt=(e,t)=>at(e,t).andThen(r=>{let n=new z(r,O.DOWNLOAD);return y.fromPromise(new Promise((o,i)=>{let s=[];return n.onMessage(c=>{ct(o,i,n,c),c.data.event===p.CHUNK_DOWNLOADED&&(s.push(c.data.chunk.buffer),s.length>=50&&(n.downloadedFile=new File(n.downloadedFile?[n.downloadedFile.slice()].concat(s):s,r.name,{type:r.type}),s.length=0)),c.data.event===p.DOWNLOAD_COMPLETE&&(n.downloadedFile=new File(n.downloadedFile?[n.downloadedFile.slice()].concat(s):s,r.name,{type:r.type}),s.length=0,n.complete())}).requestMessage({args:{lufiFile:r}})}),o=>new De(void 0,{cause:E(o)}))}),jt=(e,t)=>at(e,t).andThen(r=>w(new z(r,O.INFOS))).andThen(r=>y.fromPromise(new Promise((n,o)=>{r.onMessage(i=>{i.data.event===p.INFOS_RETRIEVED&&(r.complete(),n(r)),i.data.event===p.OPERATION_FAILED&&o(new _("An error occured while trying to retrieve informations of the file",{cause:i.data.error}))}).requestMessage({args:{lufiFile:r.lufiFile}})}),n=>new xe(void 0,{cause:E(n)}))),Ht=e=>{try{return e.status=U.PAUSED,w(e.requestMessage({action:Re.PAUSE,args:{lufiFile:e.lufiFile}}))}catch(t){return A(new Oe(void 0,{cause:E(t)}))}},zt=(e,t)=>{let r=H.fromRemoveUrl(e,t),n=new z(r,O.REMOVE);return y.fromPromise(new Promise((o,i)=>{n.onMessage(s=>{s.data.event===p.FILE_REMOVED&&(n.complete(),o(n)),s.data.event===p.OPERATION_FAILED&&i(new _("An error occured while trying to remove a file",{cause:s.data.error}))}).requestMessage({args:{lufiFile:r}})}),o=>E(o))},Wt=e=>{try{return e.status=U.ONGOING,w(e.requestMessage({action:Re.RESUME,args:{lufiFile:e.lufiFile}}))}catch(t){return A(new Ce(void 0,{cause:E(t)}))}},Gt=(e,t,r,n=Ut)=>{Ne.emit(p.SLICE_STARTED,{client:q[e.lufiFile.keys.client]});let o=Math.ceil(t.size/n)||1,i=navigator.hardwareConcurrency||1;return q[e.lufiFile.keys.client].totalChunks=o,(async()=>{for(let c=0;c<o;c++){let h=c*n,u=Math.min(h+n,t.size),f=await t.slice(h,u,t.type).arrayBuffer();e.requestMessage({args:{chunk:{buffer:f,index:c},lufiFile:q[e.lufiFile.keys.client],algo:r}},[f]),c===0?await new Promise(d=>{e.events.on(p.UPLOAD_STARTED,()=>{d(void 0)})}):c%i===0&&await new Promise(d=>{e.events.on(p.CHUNK_UPLOADED,()=>{d(void 0)})})}})(),w(void 0)},Be=(e,t,r,n,o,i,s)=>ot(s).andThen(c=>i?Fe(i,s).andThen(h=>w({password:h,clientKey:c})):w({password:i,clientKey:c})).andThen(({password:c,clientKey:h})=>{q[h]=new H(e.toString(),{delay:r,delAtFirstView:n,zipped:o,password:c,name:t.name.split("/").pop(),size:t.size,type:t.type,keys:{client:h,server:""}});let u=new z(q[h],O.UPLOAD);return q[h].uploadStatus=V.QUEUED,Gt(u,t,s).andThen(()=>y.fromPromise(new Promise((f,l)=>{u.onMessage(d=>{switch(ct(f,l,u,d),d.data.event){case p.UPLOAD_COMPLETE:u.complete(),u.lufiFile.uploadStatus=V.COMPLETE;break}})}),f=>E(f)))}),Vt=(e,t,r=0,n=!1,o=!1,i="documents.zip",s="",c=F.WebCrypto)=>{let h=[];return o?t.length===1&&t[0].type==="application/zip"?h.push(Be(e,t[0],r,n,o,s,c)):h.push(it(t).andThen(u=>st(u,i).andThen(f=>f.waitForCompletion()).andThen(f=>f.archiveFile?Be(e,f.archiveFile,r,n,!0,s,c):A(new _("archiveFile must be defined"))))):t.forEach(u=>{h.push(Be(e,u,r,n,o,s,c))}),y.combine(h).orElse(u=>A(new Le(void 0,{cause:u})))},ct=(e,t,r,n)=>{n.data.event===p.SOCKET_OPENED&&e(r),n.data.event===p.OPERATION_FAILED&&t(new _("The job returned an error",{cause:n.data.error}))},$t=()=>Object.values(q).filter(e=>e.uploadStatus===V.QUEUED),qt=e=>Object.keys($t()).indexOf(e);export{F as CryptoAlgorithm,U as JobStatus,y as ResultAsync,M as err,A as errAsync,be as isSecureContext,ht as lufi,G as ok,w as okAsync};
