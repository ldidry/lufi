var Vt=Object.create;var Ke=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Xt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,en=Object.prototype.hasOwnProperty;var rn=(r,e,t)=>e in r?Ke(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tn=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Hr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),nn=(r,e)=>{for(var t in e)Ke(r,t,{get:e[t],enumerable:!0})},on=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Xt(e))!en.call(r,i)&&i!==t&&Ke(r,i,{get:()=>e[i],enumerable:!(n=Yt(e,i))||n.enumerable});return r};var xr=(r,e,t)=>(t=r!=null?Vt(Qt(r)):{},on(e||!r||!r.__esModule?Ke(t,"default",{value:r,enumerable:!0}):t,r));var m=(r,e,t)=>rn(r,typeof e!="symbol"?e+"":e,t);var Lr=Hr((ri,Ar)=>{"use strict";var Ce=typeof Reflect=="object"?Reflect:null,qr=Ce&&typeof Ce.apply=="function"?Ce.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Ve;Ce&&typeof Ce.ownKeys=="function"?Ve=Ce.ownKeys:Object.getOwnPropertySymbols?Ve=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ve=function(e){return Object.getOwnPropertyNames(e)};function sn(r){console&&console.warn&&console.warn(r)}var Zr=Number.isNaN||function(e){return e!==e};function z(){z.init.call(this)}Ar.exports=z;Ar.exports.once=cn;z.EventEmitter=z;z.prototype._events=void 0;z.prototype._eventsCount=0;z.prototype._maxListeners=void 0;var Wr=10;function Ye(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return Wr},set:function(r){if(typeof r!="number"||r<0||Zr(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Wr=r}});z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};z.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Zr(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function $r(r){return r._maxListeners===void 0?z.defaultMaxListeners:r._maxListeners}z.prototype.getMaxListeners=function(){return $r(this)};z.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var f=o[e];if(f===void 0)return!1;if(typeof f=="function")qr(f,this,t);else for(var c=f.length,h=Qr(f,c),n=0;n<c;++n)qr(h[n],this,t);return!0};function Kr(r,e,t,n){var i,o,s;if(Ye(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),s=o[e]),s===void 0)s=o[e]=t,++r._eventsCount;else if(typeof s=="function"?s=o[e]=n?[t,s]:[s,t]:n?s.unshift(t):s.push(t),i=$r(r),i>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=s.length,sn(a)}return r}z.prototype.addListener=function(e,t){return Kr(this,e,t,!1)};z.prototype.on=z.prototype.addListener;z.prototype.prependListener=function(e,t){return Kr(this,e,t,!0)};function an(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Vr(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=an.bind(n);return i.listener=t,n.wrapFn=i,i}z.prototype.once=function(e,t){return Ye(t),this.on(e,Vr(this,e,t)),this};z.prototype.prependOnceListener=function(e,t){return Ye(t),this.prependListener(e,Vr(this,e,t)),this};z.prototype.removeListener=function(e,t){var n,i,o,s,a;if(Ye(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,o=s;break}if(o<0)return this;o===0?n.shift():un(n,o),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};z.prototype.off=z.prototype.removeListener;z.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Yr(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?fn(i):Qr(i,i.length)}z.prototype.listeners=function(e){return Yr(this,e,!0)};z.prototype.rawListeners=function(e){return Yr(this,e,!1)};z.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Xr.call(r,e)};z.prototype.listenerCount=Xr;function Xr(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}z.prototype.eventNames=function(){return this._eventsCount>0?Ve(this._events):[]};function Qr(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function un(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function fn(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function cn(r,e){return new Promise(function(t,n){function i(s){r.removeListener(e,o),n(s)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}et(r,e,o,{once:!0}),e!=="error"&&hn(r,i,{once:!0})})}function hn(r,e,t){typeof r.on=="function"&&et(r,"error",e,t)}function et(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(o){n.once&&r.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var dt=Hr((Gi,Se)=>{"use strict";var u={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(r){this.toString=function(){return"CORRUPT: "+this.message},this.message=r},invalid:function(r){this.toString=function(){return"INVALID: "+this.message},this.message=r},bug:function(r){this.toString=function(){return"BUG: "+this.message},this.message=r},notReady:function(r){this.toString=function(){return"NOT READY: "+this.message},this.message=r}}};u.cipher.aes=function(r){this.w[0][0][0]||this.C();var e,t,n,i,o=this.w[0][4],s=this.w[1];e=r.length;var a=1;if(e!==4&&e!==6&&e!==8)throw new u.exception.invalid("invalid aes key size");for(this.b=[n=r.slice(0),i=[]],r=e;r<4*e+28;r++)t=n[r-1],(r%e===0||e===8&&r%e===4)&&(t=o[t>>>24]<<24^o[t>>16&255]<<16^o[t>>8&255]<<8^o[t&255],r%e===0&&(t=t<<8^t>>>24^a<<24,a=a<<1^283*(a>>7))),n[r]=n[r-e]^t;for(e=0;r;e++,r--)t=n[e&3?r:r-4],i[e]=4>=r||4>e?t:s[0][o[t>>>24]]^s[1][o[t>>16&255]]^s[2][o[t>>8&255]]^s[3][o[t&255]]};u.cipher.aes.prototype={encrypt:function(r){return pt(this,r,0)},decrypt:function(r){return pt(this,r,1)},w:[[[],[],[],[],[]],[[],[],[],[],[]]],C:function(){var r=this.w[0],e=this.w[1],t=r[4],n=e[4],i,o,s,a=[],f=[],c,h,l,p;for(i=0;256>i;i++)f[(a[i]=i<<1^283*(i>>7))^i]=i;for(o=s=0;!t[o];o^=c||1,s=f[s]||1)for(l=s^s<<1^s<<2^s<<3^s<<4,l=l>>8^l&255^99,t[o]=l,n[l]=o,h=a[i=a[c=a[o]]],p=16843009*h^65537*i^257*c^16843008*o,h=257*a[l]^16843008*l,i=0;4>i;i++)r[i][o]=h=h<<24^h>>>8,e[i][l]=p=p<<24^p>>>8;for(i=0;5>i;i++)r[i]=r[i].slice(0),e[i]=e[i].slice(0)}};function pt(r,e,t){if(e.length!==4)throw new u.exception.invalid("invalid aes block size");var n=r.b[t],i=e[0]^n[0],o=e[t?3:1]^n[1],s=e[2]^n[2];e=e[t?1:3]^n[3];var a,f,c,h=n.length/4-2,l,p=4,v=[0,0,0,0];a=r.w[t],r=a[0];var x=a[1],g=a[2],y=a[3],D=a[4];for(l=0;l<h;l++)a=r[i>>>24]^x[o>>16&255]^g[s>>8&255]^y[e&255]^n[p],f=r[o>>>24]^x[s>>16&255]^g[e>>8&255]^y[i&255]^n[p+1],c=r[s>>>24]^x[e>>16&255]^g[i>>8&255]^y[o&255]^n[p+2],e=r[e>>>24]^x[i>>16&255]^g[o>>8&255]^y[s&255]^n[p+3],p+=4,i=a,o=f,s=c;for(l=0;4>l;l++)v[t?3&-l:l]=D[i>>>24]<<24^D[o>>16&255]<<16^D[s>>8&255]<<8^D[e&255]^n[p++],a=i,i=o,o=s,s=e,e=a;return v}u.bitArray={bitSlice:function(r,e,t){return r=u.bitArray.Y(r.slice(e/32),32-(e&31)).slice(1),t===void 0?r:u.bitArray.clamp(r,t-e)},extract:function(r,e,t){var n=Math.floor(-e-t&31);return((e+t-1^e)&-32?r[e/32|0]<<32-n^r[e/32+1|0]>>>n:r[e/32|0]>>>n)&(1<<t)-1},concat:function(r,e){if(r.length===0||e.length===0)return r.concat(e);var t=r[r.length-1],n=u.bitArray.getPartial(t);return n===32?r.concat(e):u.bitArray.Y(e,n,t|0,r.slice(0,r.length-1))},bitLength:function(r){var e=r.length;return e===0?0:32*(e-1)+u.bitArray.getPartial(r[e-1])},clamp:function(r,e){if(32*r.length<e)return r;r=r.slice(0,Math.ceil(e/32));var t=r.length;return e=e&31,0<t&&e&&(r[t-1]=u.bitArray.partial(e,r[t-1]&2147483648>>e-1,1)),r},partial:function(r,e,t){return r===32?e:(t?e|0:e<<32-r)+1099511627776*r},getPartial:function(r){return Math.round(r/1099511627776)||32},equal:function(r,e){if(u.bitArray.bitLength(r)!==u.bitArray.bitLength(e))return!1;var t=0,n;for(n=0;n<r.length;n++)t|=r[n]^e[n];return t===0},Y:function(r,e,t,n){var i;for(i=0,n===void 0&&(n=[]);32<=e;e-=32)n.push(t),t=0;if(e===0)return n.concat(r);for(i=0;i<r.length;i++)n.push(t|r[i]>>>e),t=r[i]<<32-e;return i=r.length?r[r.length-1]:0,r=u.bitArray.getPartial(i),n.push(u.bitArray.partial(e+r&31,32<e+r?t:n.pop(),1)),n},P:function(r,e){return[r[0]^e[0],r[1]^e[1],r[2]^e[2],r[3]^e[3]]},byteswapM:function(r){var e,t;for(e=0;e<r.length;++e)t=r[e],r[e]=t>>>24|t>>>8&65280|(t&65280)<<8|t<<24;return r}};u.codec.utf8String={fromBits:function(r){var e="",t=u.bitArray.bitLength(r),n,i;for(n=0;n<t/8;n++)!(n&3)&&(i=r[n/4]),e+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(e))},toBits:function(r){r=unescape(encodeURIComponent(r));var e=[],t,n=0;for(t=0;t<r.length;t++)n=n<<8|r.charCodeAt(t),(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(u.bitArray.partial(8*(t&3),n)),e}};u.codec.hex={fromBits:function(r){var e="",t;for(t=0;t<r.length;t++)e+=((r[t]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,u.bitArray.bitLength(r)/4)},toBits:function(r){var e,t=[],n;for(r=r.replace(/\s|0x/g,""),n=r.length,r=r+"00000000",e=0;e<r.length;e+=8)t.push(parseInt(r.substr(e,8),16)^0);return u.bitArray.clamp(t,4*n)}};u.codec.base64={S:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(r,e,t){var n="",i=0,o=u.codec.base64.S,s=0,a=u.bitArray.bitLength(r);for(t&&(o=o.substr(0,62)+"-_"),t=0;6*n.length<a;)n+=o.charAt((s^r[t]>>>i)>>>26),6>i?(s=r[t]<<6-i,i+=26,t++):(s<<=6,i-=6);for(;n.length&3&&!e;)n+="=";return n},toBits:function(r,e){r=r.replace(/\s|=/g,"");var t=[],n,i=0,o=u.codec.base64.S,s=0,a;for(e&&(o=o.substr(0,62)+"-_"),n=0;n<r.length;n++){if(a=o.indexOf(r.charAt(n)),0>a)throw new u.exception.invalid("this isn't base64!");26<i?(i-=26,t.push(s^a>>>i),s=a<<32-i):(i+=6,s^=a<<32-i)}return i&56&&t.push(u.bitArray.partial(i&56,s,1)),t}};u.codec.base64url={fromBits:function(r){return u.codec.base64.fromBits(r,1,1)},toBits:function(r){return u.codec.base64.toBits(r,1)}};u.hash.sha256=function(r){this.b[0]||this.C(),r?(this.g=r.g.slice(0),this.f=r.f.slice(0),this.c=r.c):this.reset()};u.hash.sha256.hash=function(r){return new u.hash.sha256().update(r).finalize()};u.hash.sha256.prototype={blockSize:512,reset:function(){return this.g=this.o.slice(0),this.f=[],this.c=0,this},update:function(r){typeof r=="string"&&(r=u.codec.utf8String.toBits(r));var e,t=this.f=u.bitArray.concat(this.f,r);if(e=this.c,r=this.c=e+u.bitArray.bitLength(r),9007199254740991<r)throw new u.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var n=new Uint32Array(t),i=0;for(e=512+e-(512+e&511);e<=r;e+=512)this.l(n.subarray(16*i,16*(i+1))),i+=1;t.splice(0,16*i)}else for(e=512+e-(512+e&511);e<=r;e+=512)this.l(t.splice(0,16));return this},finalize:function(){var r,t=this.f,e=this.g,t=u.bitArray.concat(t,[u.bitArray.partial(1,1)]);for(r=t.length+2;r&15;r++)t.push(0);for(t.push(Math.floor(this.c/4294967296)),t.push(this.c|0);t.length;)this.l(t.splice(0,16));return this.reset(),e},o:[],b:[],C:function(){function r(o){return 4294967296*(o-Math.floor(o))|0}for(var e=0,t=2,n,i;64>e;t++){for(i=!0,n=2;n*n<=t;n++)if(t%n===0){i=!1;break}i&&(8>e&&(this.o[e]=r(Math.pow(t,.5))),this.b[e]=r(Math.pow(t,1/3)),e++)}},l:function(r){var e,t,n,i=this.g,o=this.b,s=i[0],a=i[1],f=i[2],c=i[3],h=i[4],l=i[5],p=i[6],v=i[7];for(e=0;64>e;e++)16>e?t=r[e]:(t=r[e+1&15],n=r[e+14&15],t=r[e&15]=(t>>>7^t>>>18^t>>>3^t<<25^t<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+r[e&15]+r[e+9&15]|0),t=t+v+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(p^h&(l^p))+o[e],v=p,p=l,l=h,h=c+t|0,c=f,f=a,a=s,s=t+(a&f^c&(a^f))+(a>>>2^a>>>13^a>>>22^a<<30^a<<19^a<<10)|0;i[0]=i[0]+s|0,i[1]=i[1]+a|0,i[2]=i[2]+f|0,i[3]=i[3]+c|0,i[4]=i[4]+h|0,i[5]=i[5]+l|0,i[6]=i[6]+p|0,i[7]=i[7]+v|0}};u.hash.sha512=function(r){this.b[0]||this.C(),r?(this.g=r.g.slice(0),this.f=r.f.slice(0),this.c=r.c):this.reset()};u.hash.sha512.hash=function(r){return new u.hash.sha512().update(r).finalize()};u.hash.sha512.prototype={blockSize:1024,reset:function(){return this.g=this.o.slice(0),this.f=[],this.c=0,this},update:function(r){typeof r=="string"&&(r=u.codec.utf8String.toBits(r));var e,t=this.f=u.bitArray.concat(this.f,r);if(e=this.c,r=this.c=e+u.bitArray.bitLength(r),9007199254740991<r)throw new u.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var n=new Uint32Array(t),i=0;for(e=1024+e-(1024+e&1023);e<=r;e+=1024)this.l(n.subarray(32*i,32*(i+1))),i+=1;t.splice(0,32*i)}else for(e=1024+e-(1024+e&1023);e<=r;e+=1024)this.l(t.splice(0,32));return this},finalize:function(){var r,t=this.f,e=this.g,t=u.bitArray.concat(t,[u.bitArray.partial(1,1)]);for(r=t.length+4;r&31;r++)t.push(0);for(t.push(0),t.push(0),t.push(Math.floor(this.c/4294967296)),t.push(this.c|0);t.length;)this.l(t.splice(0,32));return this.reset(),e},o:[],ia:[12372232,13281083,9762859,1914609,15106769,4090911,4308331,8266105],b:[],ka:[2666018,15689165,5061423,9034684,4764984,380953,1658779,7176472,197186,7368638,14987916,16757986,8096111,1480369,13046325,6891156,15813330,5187043,9229749,11312229,2818677,10937475,4324308,1135541,6741931,11809296,16458047,15666916,11046850,698149,229999,945776,13774844,2541862,12856045,9810911,11494366,7844520,15576806,8533307,15795044,4337665,16291729,5553712,15684120,6662416,7413802,12308920,13816008,4303699,9366425,10176680,13195875,4295371,6546291,11712675,15708924,1519456,15772530,6568428,6495784,8568297,13007125,7492395,2515356,12632583,14740254,7262584,1535930,13146278,16321966,1853211,294276,13051027,13221564,1051980,4080310,6651434,14088940,4675607],C:function(){function r(s){return 4294967296*(s-Math.floor(s))|0}function e(s){return 1099511627776*(s-Math.floor(s))&255}for(var t=0,n=2,i,o;80>t;n++){for(o=!0,i=2;i*i<=n;i++)if(n%i===0){o=!1;break}o&&(8>t&&(this.o[2*t]=r(Math.pow(n,.5)),this.o[2*t+1]=e(Math.pow(n,.5))<<24|this.ia[t]),this.b[2*t]=r(Math.pow(n,1/3)),this.b[2*t+1]=e(Math.pow(n,1/3))<<24|this.ka[t],t++)}},l:function(r){var e,t,n=this.g,i=this.b,o=n[0],s=n[1],a=n[2],f=n[3],c=n[4],h=n[5],l=n[6],p=n[7],v=n[8],x=n[9],g=n[10],y=n[11],D=n[12],T=n[13],C=n[14],E=n[15],A;if(typeof Uint32Array<"u"){A=Array(160);for(var L=0;32>L;L++)A[L]=r[L]}else A=r;var L=o,b=s,w=a,d=f,k=c,O=h,I=l,V=p,S=v,P=x,j=g,M=y,Z=D,G=T,de=C,K=E;for(r=0;80>r;r++){if(16>r)e=A[2*r],t=A[2*r+1];else{t=A[2*(r-15)];var F=A[2*(r-15)+1];e=(F<<31|t>>>1)^(F<<24|t>>>8)^t>>>7;var Y=(t<<31|F>>>1)^(t<<24|F>>>8)^(t<<25|F>>>7);t=A[2*(r-2)];var _=A[2*(r-2)+1],F=(_<<13|t>>>19)^(t<<3|_>>>29)^t>>>6,_=(t<<13|_>>>19)^(_<<3|t>>>29)^(t<<26|_>>>6),te=A[2*(r-7)],re=A[2*(r-16)],ne=A[2*(r-16)+1];t=Y+A[2*(r-7)+1],e=e+te+(t>>>0<Y>>>0?1:0),t+=_,e+=F+(t>>>0<_>>>0?1:0),t+=ne,e+=re+(t>>>0<ne>>>0?1:0)}A[2*r]=e|=0,A[2*r+1]=t|=0;var te=S&j^~S&Z,Q=P&M^~P&G,_=L&w^L&k^w&k,N=b&d^b&O^d&O,re=(b<<4|L>>>28)^(L<<30|b>>>2)^(L<<25|b>>>7),ne=(L<<4|b>>>28)^(b<<30|L>>>2)^(b<<25|L>>>7),we=i[2*r],Ae=i[2*r+1],F=K+((S<<18|P>>>14)^(S<<14|P>>>18)^(P<<23|S>>>9)),Y=de+((P<<18|S>>>14)^(P<<14|S>>>18)^(S<<23|P>>>9))+(F>>>0<K>>>0?1:0),F=F+Q,Y=Y+(te+(F>>>0<Q>>>0?1:0)),F=F+Ae,Y=Y+(we+(F>>>0<Ae>>>0?1:0)),F=F+t|0,Y=Y+(e+(F>>>0<t>>>0?1:0));t=ne+N,e=re+_+(t>>>0<ne>>>0?1:0),de=Z,K=G,Z=j,G=M,j=S,M=P,P=V+F|0,S=I+Y+(P>>>0<V>>>0?1:0)|0,I=k,V=O,k=w,O=d,w=L,d=b,b=F+t|0,L=Y+e+(b>>>0<F>>>0?1:0)|0}s=n[1]=s+b|0,n[0]=o+L+(s>>>0<b>>>0?1:0)|0,f=n[3]=f+d|0,n[2]=a+w+(f>>>0<d>>>0?1:0)|0,h=n[5]=h+O|0,n[4]=c+k+(h>>>0<O>>>0?1:0)|0,p=n[7]=p+V|0,n[6]=l+I+(p>>>0<V>>>0?1:0)|0,x=n[9]=x+P|0,n[8]=v+S+(x>>>0<P>>>0?1:0)|0,y=n[11]=y+M|0,n[10]=g+j+(y>>>0<M>>>0?1:0)|0,T=n[13]=T+G|0,n[12]=D+Z+(T>>>0<G>>>0?1:0)|0,E=n[15]=E+K|0,n[14]=C+de+(E>>>0<K>>>0?1:0)|0}};u.mode.ccm={name:"ccm",F:[],listenProgress:function(r){u.mode.ccm.F.push(r)},unListenProgress:function(r){r=u.mode.ccm.F.indexOf(r),-1<r&&u.mode.ccm.F.splice(r,1)},da:function(r){var e=u.mode.ccm.F.slice(),t;for(t=0;t<e.length;t+=1)e[t](r)},encrypt:function(r,e,t,n,i){var o,s=e.slice(0),a=u.bitArray,f=a.bitLength(t)/8,c=a.bitLength(s)/8;if(i=i||64,n=n||[],7>f)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;4>o&&c>>>8*o;o++);return o<15-f&&(o=15-f),t=a.clamp(t,8*(15-o)),e=u.mode.ccm.U(r,e,t,n,i,o),s=u.mode.ccm.V(r,s,t,e,i,o),a.concat(s.data,s.tag)},decrypt:function(r,e,t,n,i){i=i||64,n=n||[];var o=u.bitArray,s=o.bitLength(t)/8,c=o.bitLength(e),a=o.clamp(e,c-i),f=o.bitSlice(e,c-i),c=(c-i)/8;if(7>s)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&c>>>8*e;e++);if(e<15-s&&(e=15-s),t=o.clamp(t,8*(15-e)),a=u.mode.ccm.V(r,a,t,f,i,e),r=u.mode.ccm.U(r,a.data,t,n,i,e),!o.equal(a.tag,r))throw new u.exception.corrupt("ccm: tag doesn't match");return a.data},ma:function(r,e,t,n,i,o){var s=[],a=u.bitArray,f=a.P;if(n=[a.partial(8,(e.length?64:0)|n-2<<2|o-1)],n=a.concat(n,t),n[3]|=i,n=r.encrypt(n),e.length)for(t=a.bitLength(e)/8,65279>=t?s=[a.partial(16,t)]:4294967295>=t&&(s=a.concat([a.partial(16,65534)],[t])),s=a.concat(s,e),e=0;e<s.length;e+=4)n=r.encrypt(f(n,s.slice(e,e+4).concat([0,0,0])));return n},U:function(r,e,t,n,i,o){var s=u.bitArray,a=s.P;if(i/=8,i%2||4>i||16<i)throw new u.exception.invalid("ccm: invalid tag length");if(4294967295<n.length||4294967295<e.length)throw new u.exception.bug("ccm: can't deal with 4GiB or more data");for(t=u.mode.ccm.ma(r,n,t,i,s.bitLength(e)/8,o),n=0;n<e.length;n+=4)t=r.encrypt(a(t,e.slice(n,n+4).concat([0,0,0])));return s.clamp(t,8*i)},V:function(r,e,t,n,i,o){var s,a=u.bitArray;s=a.P;var f=e.length,c=a.bitLength(e),h=f/50,l=h;if(t=a.concat([a.partial(8,o-1)],t).concat([0,0,0]).slice(0,4),n=a.bitSlice(s(n,r.encrypt(t)),0,i),!f)return{tag:n,data:[]};for(s=0;s<f;s+=4)s>h&&(u.mode.ccm.da(s/f),h+=l),t[3]++,i=r.encrypt(t),e[s]^=i[0],e[s+1]^=i[1],e[s+2]^=i[2],e[s+3]^=i[3];return{tag:n,data:a.clamp(e,c)}}};u.misc.hmac=function(r,e){this.W=e=e||u.hash.sha256;var t=[[],[]],n,i=e.prototype.blockSize/32;for(this.B=[new e,new e],r.length>i&&(r=e.hash(r)),n=0;n<i;n++)t[0][n]=r[n]^909522486,t[1][n]=r[n]^1549556828;this.B[0].update(t[0]),this.B[1].update(t[1]),this.O=new e(this.B[0])};u.misc.hmac.prototype.encrypt=u.misc.hmac.prototype.mac=function(r){if(this.Z)throw new u.exception.invalid("encrypt on already updated hmac called!");return this.update(r),this.digest(r)};u.misc.hmac.prototype.reset=function(){this.O=new this.W(this.B[0]),this.Z=!1};u.misc.hmac.prototype.update=function(r){this.Z=!0,this.O.update(r)};u.misc.hmac.prototype.digest=function(){var r=this.O.finalize(),r=new this.W(this.B[1]).update(r).finalize();return this.reset(),r};u.misc.pbkdf2=function(r,e,t,n,i){if(t=t||1e4,0>n||0>t)throw new u.exception.invalid("invalid params to pbkdf2");typeof r=="string"&&(r=u.codec.utf8String.toBits(r)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),i=i||u.misc.hmac,r=new i(r);var o,s,a,f,c=[],h=u.bitArray;for(f=1;32*c.length<(n||1);f++){for(i=o=r.encrypt(h.concat(e,[f])),s=1;s<t;s++)for(o=r.encrypt(o),a=0;a<o.length;a++)i[a]^=o[a];c=c.concat(i)}return n&&(c=h.clamp(c,n)),c};u.prng=function(r){this.h=[new u.hash.sha256],this.s=[0],this.N=0,this.G={},this.M=0,this.T={},this.X=this.i=this.u=this.fa=0,this.b=[0,0,0,0,0,0,0,0],this.m=[0,0,0,0],this.K=void 0,this.L=r,this.D=!1,this.J={progress:{},seeded:{}},this.A=this.ea=0,this.H=1,this.I=2,this.aa=65536,this.R=[0,48,64,96,128,192,256,384,512,768,1024],this.ba=3e4,this.$=80};u.prng.prototype={randomWords:function(r,e){var t=[],n;n=this.isReady(e);var i;if(n===this.A)throw new u.exception.notReady("generator isn't seeded");if(n&this.I){n=!(n&this.H),i=[];var o=0,s;for(this.X=i[0]=new Date().valueOf()+this.ba,s=0;16>s;s++)i.push(4294967296*Math.random()|0);for(s=0;s<this.h.length&&(i=i.concat(this.h[s].finalize()),o+=this.s[s],this.s[s]=0,n||!(this.N&1<<s));s++);for(this.N>=1<<this.h.length&&(this.h.push(new u.hash.sha256),this.s.push(0)),this.i-=o,o>this.u&&(this.u=o),this.N++,this.b=u.hash.sha256.hash(this.b.concat(i)),this.K=new u.cipher.aes(this.b),n=0;4>n&&(this.m[n]=this.m[n]+1|0,!this.m[n]);n++);}for(n=0;n<r;n+=4)(n+1)%this.aa===0&&mt(this),i=Or(this),t.push(i[0],i[1],i[2],i[3]);return mt(this),t.slice(0,r)},setDefaultParanoia:function(r,e){if(r===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new u.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.L=r},addEntropy:function(r,e,t){t=t||"user";var n,i,o=new Date().valueOf(),s=this.G[t],a=this.isReady(),f=0;switch(n=this.T[t],n===void 0&&(n=this.T[t]=this.fa++),s===void 0&&(s=this.G[t]=0),this.G[t]=(this.G[t]+1)%this.h.length,typeof r){case"number":e===void 0&&(e=1),this.h[s].update([n,this.M++,1,e,o,1,r|0]);break;case"object":if(t=Object.prototype.toString.call(r),t==="[object Uint32Array]"){for(i=[],t=0;t<r.length;t++)i.push(r[t]);r=i}else for(t!=="[object Array]"&&(f=1),t=0;t<r.length&&!f;t++)typeof r[t]!="number"&&(f=1);if(!f){if(e===void 0)for(t=e=0;t<r.length;t++)for(i=r[t];0<i;)e++,i=i>>>1;this.h[s].update([n,this.M++,2,e,o,r.length].concat(r))}break;case"string":e===void 0&&(e=r.length),this.h[s].update([n,this.M++,3,e,o,r.length]),this.h[s].update(r);break;default:f=1}if(f)throw new u.exception.bug("random: addEntropy only supports number, array of numbers or string");this.s[s]+=e,this.i+=e,a===this.A&&(this.isReady()!==this.A&&vt("seeded",Math.max(this.u,this.i)),vt("progress",this.getProgress()))},isReady:function(r){return r=this.R[r!==void 0?r:this.L],this.u&&this.u>=r?this.s[0]>this.$&&new Date().valueOf()>this.X?this.I|this.H:this.H:this.i>=r?this.I|this.A:this.A},getProgress:function(r){return r=this.R[r||this.L],this.u>=r||this.i>r?1:this.i/r},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:_e(this,this.la),mouseCollector:_e(this,this.na),keyboardCollector:_e(this,this.ja),accelerometerCollector:_e(this,this.ca),touchCollector:_e(this,this.pa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new u.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(r,e){this.J[r][this.ea++]=e},removeEventListener:function(r,e){var t,n,i=this.J[r],o=[];for(n in i)i.hasOwnProperty(n)&&i[n]===e&&o.push(n);for(t=0;t<o.length;t++)n=o[t],delete i[n]},ja:function(){je(this,1)},na:function(r){var e,t;try{e=r.x||r.clientX||r.offsetX||0,t=r.y||r.clientY||r.offsetY||0}catch{t=e=0}e!=0&&t!=0&&this.addEntropy([e,t],2,"mouse"),je(this,0)},pa:function(r){r=r.touches[0]||r.changedTouches[0],this.addEntropy([r.pageX||r.clientX,r.pageY||r.clientY],1,"touch"),je(this,0)},la:function(){je(this,2)},ca:function(r){if(r=r.accelerationIncludingGravity.x||r.accelerationIncludingGravity.y||r.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;typeof e=="number"&&this.addEntropy(e,1,"accelerometer")}r&&this.addEntropy(r,2,"accelerometer"),je(this,0)}};function vt(r,e){var t,n=u.random.J[r],i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);for(t=0;t<i.length;t++)i[t](e)}function je(r,e){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?r.addEntropy(window.performance.now(),e,"loadtime"):r.addEntropy(new Date().valueOf(),e,"loadtime")}function mt(r){r.b=Or(r).concat(Or(r)),r.K=new u.cipher.aes(r.b)}function Or(r){for(var e=0;4>e&&(r.m[e]=r.m[e]+1|0,!r.m[e]);e++);return r.K.encrypt(r.m)}function _e(r,e){return function(){e.apply(r,arguments)}}u.random=new u.prng(6);e:try{if(rr=typeof Se<"u"&&Se.exports){try{tr=tn("crypto")}catch{tr=null}rr=er=tr}if(rr&&er.randomBytes)Ne=er.randomBytes(128),Ne=new Uint32Array(new Uint8Array(Ne).buffer),u.random.addEntropy(Ne,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(Je=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(Je);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(Je);else break e;u.random.addEntropy(Je,1024,"crypto['getRandomValues']")}}catch(r){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(r))}var Ne,er,Je,rr,tr;u.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ha:function(r,e,t,n){t=t||{},n=n||{};var i=u.json,o=i.j({iv:u.random.randomWords(4,0)},i.defaults),s;if(i.j(o,t),t=o.adata,typeof o.salt=="string"&&(o.salt=u.codec.base64.toBits(o.salt)),typeof o.iv=="string"&&(o.iv=u.codec.base64.toBits(o.iv)),!u.mode[o.mode]||!u.cipher[o.cipher]||typeof r=="string"&&100>=o.iter||o.ts!==64&&o.ts!==96&&o.ts!==128||o.ks!==128&&o.ks!==192&&o.ks!==256||2>o.iv.length||4<o.iv.length)throw new u.exception.invalid("json encrypt: invalid parameters");return typeof r=="string"?(s=u.misc.cachedPbkdf2(r,o),r=s.key.slice(0,o.ks/32),o.salt=s.salt):u.ecc&&r instanceof u.ecc.elGamal.publicKey&&(s=r.kem(),o.kemtag=s.tag,r=s.key.slice(0,o.ks/32)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),typeof t=="string"&&(o.adata=t=u.codec.utf8String.toBits(t)),s=new u.cipher[o.cipher](r),i.j(n,o),n.key=r,o.ct=o.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&e instanceof ArrayBuffer?u.arrayBuffer.ccm.encrypt(s,e,o.iv,t,o.ts):u.mode[o.mode].encrypt(s,e,o.iv,t,o.ts),o},encrypt:function(r,e,t,n){var i=u.json,o=i.ha.apply(i,arguments);return i.encode(o)},ga:function(r,e,t,n){t=t||{},n=n||{};var i=u.json;e=i.j(i.j(i.j({},i.defaults),e),t,!0);var o,s;if(o=e.adata,typeof e.salt=="string"&&(e.salt=u.codec.base64.toBits(e.salt)),typeof e.iv=="string"&&(e.iv=u.codec.base64.toBits(e.iv)),!u.mode[e.mode]||!u.cipher[e.cipher]||typeof r=="string"&&100>=e.iter||e.ts!==64&&e.ts!==96&&e.ts!==128||e.ks!==128&&e.ks!==192&&e.ks!==256||!e.iv||2>e.iv.length||4<e.iv.length)throw new u.exception.invalid("json decrypt: invalid parameters");return typeof r=="string"?(s=u.misc.cachedPbkdf2(r,e),r=s.key.slice(0,e.ks/32),e.salt=s.salt):u.ecc&&r instanceof u.ecc.elGamal.secretKey&&(r=r.unkem(u.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),typeof o=="string"&&(o=u.codec.utf8String.toBits(o)),s=new u.cipher[e.cipher](r),o=e.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&e.ct instanceof ArrayBuffer?u.arrayBuffer.ccm.decrypt(s,e.ct,e.iv,e.tag,o,e.ts):u.mode[e.mode].decrypt(s,e.ct,e.iv,o,e.ts),i.j(n,e),n.key=r,t.raw===1?o:u.codec.utf8String.fromBits(o)},decrypt:function(r,e,t,n){var i=u.json;return i.ga(r,i.decode(e),t,n)},encode:function(r){var e,t="{",n="";for(e in r)if(r.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new u.exception.invalid("json encode: invalid property name");switch(t+=n+'"'+e+'":',n=",",typeof r[e]){case"number":case"boolean":t+=r[e];break;case"string":t+='"'+escape(r[e])+'"';break;case"object":t+='"'+u.codec.base64.fromBits(r[e],0)+'"';break;default:throw new u.exception.bug("json encode: unsupported type")}}return t+"}"},decode:function(r){if(r=r.replace(/\s/g,""),!r.match(/^\{.*\}$/))throw new u.exception.invalid("json decode: this isn't json!");r=r.replace(/^\{|\}$/g,"").split(/,/);var e={},t,n;for(t=0;t<r.length;t++){if(!(n=r[t].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new u.exception.invalid("json decode: this isn't json!");n[3]!=null?e[n[2]]=parseInt(n[3],10):n[4]!=null?e[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?u.codec.base64.toBits(n[4]):unescape(n[4]):n[5]!=null&&(e[n[2]]=n[5]==="true")}return e},j:function(r,e,t){if(r===void 0&&(r={}),e===void 0)return r;for(var n in e)if(e.hasOwnProperty(n)){if(t&&r[n]!==void 0&&r[n]!==e[n])throw new u.exception.invalid("required parameter overridden");r[n]=e[n]}return r},ra:function(r,e){var t={},n;for(n in r)r.hasOwnProperty(n)&&r[n]!==e[n]&&(t[n]=r[n]);return t},qa:function(r,e){var t={},n;for(n=0;n<e.length;n++)r[e[n]]!==void 0&&(t[e[n]]=r[e[n]]);return t}};u.encrypt=u.json.encrypt;u.decrypt=u.json.decrypt;u.misc.oa={};u.misc.cachedPbkdf2=function(r,e){var t=u.misc.oa,n;return e=e||{},n=e.iter||1e3,t=t[r]=t[r]||{},n=t[n]=t[n]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):u.random.randomWords(2,0)},t=e.salt===void 0?n.firstSalt:e.salt,n[t]=n[t]||u.misc.pbkdf2(r,t,e.iter),{key:n[t].slice(0),salt:t.slice(0)}};typeof Se<"u"&&Se.exports&&(Se.exports=u);typeof define=="function"&&define([],function(){return u})});var Gr={};nn(Gr,{addFilesToArchive:()=>Wt,cancel:()=>Gn,compress:()=>Zt,decompress:()=>Hn,download:()=>qn,events:()=>Jr,getFileIndexInQueue:()=>Qn,infos:()=>Wn,pause:()=>Zn,remove:()=>$n,resume:()=>Kn,upload:()=>Yn});var qt=xr(Lr());var ln={withStackTrace:!1},nt=(r,e,t=ln)=>{let n=e.isOk()?{type:"Ok",value:e.value}:{type:"Err",value:e.error},i=t.withStackTrace?new Error().stack:void 0;return{data:n,message:r,stack:i}};function Oe(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(h){try{c(n.next(h))}catch(l){s(l)}}function f(h){try{c(n.throw(h))}catch(l){s(l)}}function c(h){h.done?o(h.value):i(h.value).then(a,f)}c((n=n.apply(r,e||[])).next())})}function rt(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function le(r){return this instanceof le?(this.v=r,this):new le(r)}function tt(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(v){return function(x){return Promise.resolve(x).then(v,l)}}function a(v,x){n[v]&&(i[v]=function(g){return new Promise(function(y,D){o.push([v,g,y,D])>1||f(v,g)})},x&&(i[v]=x(i[v])))}function f(v,x){try{c(n[v](x))}catch(g){p(o[0][3],g)}}function c(v){v.value instanceof le?Promise.resolve(v.value.v).then(h,l):p(o[0][2],v)}function h(v){f("next",v)}function l(v){f("throw",v)}function p(v,x){v(x),o.shift(),o.length&&f(o[0][0],o[0][1])}}function pn(r){var e,t;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,o){e[i]=r[i]?function(s){return(t=!t)?{value:le(r[i](s)),done:!1}:o?o(s):s}:o}}function vn(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof rt=="function"?rt(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,f){s=r[o](s),i(a,f,s.done,s.value)})}}function i(o,s,a,f){Promise.resolve(f).then(function(c){o({value:c,done:a})},s)}}var R=class r{constructor(e){this._promise=e}static fromSafePromise(e){let t=e.then(n=>new ie(n));return new r(t)}static fromPromise(e,t){let n=e.then(i=>new ie(i)).catch(i=>new oe(t(i)));return new r(n)}static fromThrowable(e,t){return(...n)=>new r(Oe(this,void 0,void 0,function*(){try{return new ie(yield e(...n))}catch(i){return new oe(t?t(i):i)}}))}static combine(e){return mn(e)}static combineWithAllErrors(e){return dn(e)}map(e){return new r(this._promise.then(t=>Oe(this,void 0,void 0,function*(){return t.isErr()?new oe(t.error):new ie(yield e(t.value))})))}andThrough(e){return new r(this._promise.then(t=>Oe(this,void 0,void 0,function*(){if(t.isErr())return new oe(t.error);let n=yield e(t.value);return n.isErr()?new oe(n.error):new ie(t.value)})))}andTee(e){return new r(this._promise.then(t=>Oe(this,void 0,void 0,function*(){if(t.isErr())return new oe(t.error);try{yield e(t.value)}catch{}return new ie(t.value)})))}mapErr(e){return new r(this._promise.then(t=>Oe(this,void 0,void 0,function*(){return t.isOk()?new ie(t.value):new oe(yield e(t.error))})))}andThen(e){return new r(this._promise.then(t=>{if(t.isErr())return new oe(t.error);let n=e(t.value);return n instanceof r?n._promise:n}))}orElse(e){return new r(this._promise.then(t=>Oe(this,void 0,void 0,function*(){return t.isErr()?e(t.error):new ie(t.value)})))}match(e,t){return this._promise.then(n=>n.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return tt(this,arguments,function*(){return yield le(yield le(yield*pn(vn(yield le(this._promise.then(t=>t.safeUnwrap()))))))})}then(e,t){return this._promise.then(e,t)}[Symbol.asyncIterator](){return tt(this,arguments,function*(){let t=yield le(this._promise);return t.isErr()&&(yield yield le(H(t.error))),yield le(t.value)})}},$=r=>new R(Promise.resolve(new ie(r))),H=r=>new R(Promise.resolve(new oe(r))),ti=R.fromPromise,ni=R.fromSafePromise,ii=R.fromThrowable,it=r=>{let e=pe([]);for(let t of r)if(t.isErr()){e=se(t.error);break}else e.map(n=>n.push(t.value));return e},mn=r=>R.fromSafePromise(Promise.all(r)).andThen(it),ot=r=>{let e=pe([]);for(let t of r)t.isErr()&&e.isErr()?e.error.push(t.error):t.isErr()&&e.isOk()?e=se([t.error]):t.isOk()&&e.isOk()&&e.value.push(t.value);return e},dn=r=>R.fromSafePromise(Promise.all(r)).andThen(ot),br;(function(r){function e(i,o){return(...s)=>{try{let a=i(...s);return pe(a)}catch(a){return se(o?o(a):a)}}}r.fromThrowable=e;function t(i){return it(i)}r.combine=t;function n(i){return ot(i)}r.combineWithAllErrors=n})(br||(br={}));var pe=r=>new ie(r);function se(r){return new oe(r)}var ie=class{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return pe(e(this.value))}mapErr(e){return pe(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(t=>this.value)}andTee(e){try{e(this.value)}catch{}return pe(this.value)}orElse(e){return pe(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return R.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){let e=this.value;return function*(){return e}()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw nt("Called `_unsafeUnwrapErr` on an Ok",this,e)}*[Symbol.iterator](){return this.value}},oe=class{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return se(this.error)}mapErr(e){return se(e(this.error))}andThrough(e){return se(this.error)}andTee(e){return se(this.error)}andThen(e){return se(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return H(this.error)}asyncAndThrough(e){return H(this.error)}asyncMap(e){return H(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){let e=this.error;return function*(){throw yield se(e),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(e){throw nt("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}*[Symbol.iterator](){let e=this;return yield e,e}},oi=br.fromThrowable;var Ee=class r{constructor(e,t){m(this,"actionToken","");m(this,"chunksReady",0);m(this,"createdAt",0);m(this,"delay",0);m(this,"delAtFirstView",!1);m(this,"keys",{client:"",server:""});m(this,"name","");m(this,"password","");m(this,"queueIndex",0);m(this,"serverUrl");m(this,"size",0);m(this,"uploadStatus",3);m(this,"totalChunks",0);m(this,"type","");m(this,"zipped",!1);this.serverUrl=e,Object.assign(this,t)}downloadUrl(){let e=new URL(this.serverUrl);return new URL(`${e.origin+e.pathname}r/${this.keys.server}#${this.keys.client}`)}removeUrl(){let e=new URL(this.serverUrl);return new URL(`${e.origin+e.pathname}d/${this.keys.server}/${this.actionToken}`)}static fromDownloadUrl(e,t=""){let n=e.pathname.split("r/"),i={client:e.hash.slice(1).split("&")[0],server:n[1]};return new r(e.origin+n[0],{keys:i,password:t})}static fromRemoveUrl(e,t=""){let n=e.pathname.split("d/"),i=n[1].split("/"),o={client:"",server:i[0]};return new r(e.origin+n[0],{keys:o,password:t,actionToken:i[1]})}};var ct=xr(Lr());var q=class extends Error{constructor(t,n={}){let{cause:i,context:o}=n;super(t,{cause:i});m(this,"context");this.name=this.constructor.name,this.context=o}};var Xe=class extends q{constructor(){super(...arguments);m(this,"message","Unable to connect. Is the computer able to access the url?")}};var Qe=class extends q{constructor(){super(...arguments);m(this,"message","The server returned an error")}};var J=r=>{if(r instanceof Error)return r;let e="[Unable to stringify the thrown value]";try{e=JSON.stringify(r)}catch{}return new Error(e)},at=r=>{let e=r.href.match(/(.*?)\/?(?:\/[dr]{1}\/|login\/?|files\/?)/),t=e&&e[1]?e[1]:r.origin;return R.fromPromise(fetch(t+"/about/config"),n=>new Xe(void 0,{cause:J(n)})).andThen(n=>n.ok?R.fromPromise(n.json(),i=>J(i)):H(new Qe(void 0,{context:n.statusText})))},ut=()=>typeof Deno<"u",Dr=()=>ut()||typeof window<"u"&&(window.isSecureContext||window.location.protocol==="https:"),ft=r=>ut()?new URL(`./worker/${r}.ts`,new URL(".",import.meta.url).href):new URL(import.meta.resolve(`./${r==="main"?`worker/${r}`:r}.js`));var xe=class{constructor(e){m(this,"events",new ct.default);m(this,"lufiFile");m(this,"status",2);m(this,"tmpFile");m(this,"tmpChunks",[]);m(this,"worker");m(this,"isTerminated",!1);m(this,"complete",()=>{this.status=0,this.events.emit("JOB_TERMINATED")});m(this,"hasFailed",()=>this.status===1);m(this,"onError",e=>(this.worker.onerror=t=>{e(t)},this));m(this,"onMessage",e=>(this.worker.onmessage=t=>{e&&e(t);let n=t.data.event;n&&(n==="FILE_UPDATED"?Object.assign(this.lufiFile,t.data.lufiFile):this.dispatchEvent(n,t.data.error))},this));m(this,"onMessageError",e=>(this.worker.onmessageerror=t=>{e(t)},this));m(this,"onProgress",e=>(this.events.on("CHUNK_UPLOADED",()=>{e()}),this.events.on("CHUNK_DOWNLOADED",()=>{e()}),this));m(this,"requestMessage",(e,t=[])=>(this.worker.postMessage(e,t),this));m(this,"terminate",()=>(this.worker.terminate(),this));m(this,"waitForCompletion",()=>this.isTerminated?this.status===0?$(this):H(J("Job has failed")):R.fromPromise(new Promise((e,t)=>{this.events.once("OPERATION_FAILED",n=>{t(n)}),this.events.once("JOB_TERMINATED",()=>{this.status===0&&e(this)})}),e=>J(e)));m(this,"dispatchEvent",(e,t)=>{this.events.emit(e,t)});this.worker=new Worker(ft("main"),{type:"module"}),this.lufiFile=e,this.events.once("JOB_TERMINATED",()=>{this.isTerminated=!0,this.terminate()}),this.events.once("OPERATION_FAILED",t=>{this.status=1,this.lufiFile.uploadStatus=2,this.events.emit("JOB_TERMINATED",t)}),this.onError(t=>console.error(t.error))}};var Pe=(t=>(t[t.Sjcl=0]="Sjcl",t[t.WebCrypto=1]="WebCrypto",t))(Pe||{});var ke=class{constructor(e,t){if(!e||e.length!=64)throw Error("Charset must contain 64 characters");this._charset=e,this._noPadding=!!t,this._valid=new RegExp("^["+this._charset.replace("-","\\-")+"]+={0,2}$")}Encode(e){let t=e.byteLength;if(!t)return"";let n=new Uint8Array(e),i="";for(let o=0;o<t;o+=3)i+=this._charset[n[o]>>2]+this._charset[(n[o]&3)<<4|n[o+1]>>4]+this._charset[(n[o+1]&15)<<2|n[o+2]>>6]+this._charset[n[o+2]&63];return t%3==2?(i=i.substring(0,i.length-1),this._noPadding||(i+="=")):t%3==1&&(i=i.substring(0,i.length-2),this._noPadding||(i+="==")),i}Decode(e){if(e=(e||"").replace(/[\s]/g,""),!e)return new ArrayBuffer(0);if(!this._valid.test(e))throw Error("Invalid base64 input sequence");let t=Math.floor(e.length*.75);e[e.length-2]=="="?t-=2:e[e.length-1]=="="&&t--;let n=new Uint8Array(t),i,o,s,a,f=0,c=0;for(;f<e.length*.75;)i=this._charset.indexOf(e.charAt(c++)),o=this._charset.indexOf(e.charAt(c++)),s=this._charset.indexOf(e.charAt(c++)),a=this._charset.indexOf(e.charAt(c++)),n[f++]=i<<2|o>>4,n[f++]=(o&15)<<4|s>>2,n[f++]=(s&3)<<6|a;return n.buffer}};var Ii=new ke("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");var wn=new ke("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",!0);function Cr(r){return wn.Encode(r)}var Ge=xr(dt());var ce=class extends q{};var Me=class extends ce{constructor(){super(...arguments);m(this,"message","Unable to hash the provided string")}};var yt=()=>{try{return $(Ge.default.codec.base64.fromBits(Ge.default.random.randomWords(8,10)))}catch(r){return H(new ce("Unable to generate key",{cause:J(r)}))}},gt=r=>{try{return $(Ge.default.codec.hex.fromBits(Ge.default.hash.sha512.hash(r)))}catch(e){return H(new Me(void 0,{cause:J(e)}))}};var wt=()=>R.fromPromise(new Promise((r,e)=>crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(t=>crypto.subtle.exportKey("raw",t).then(n=>r(Cr(n))).catch(n=>{e(new ce("Unable to base64 encode the url",{cause:J(n)}))})).catch(t=>e(t))),r=>new ce("Unable to generate key",{cause:J(r)})),Et=r=>{let e=async()=>Array.from(new Uint8Array(await crypto.subtle.digest("SHA-512",new TextEncoder().encode(r)))).map(t=>t.toString(16).padStart(2,"0")).join("");return R.fromPromise(e(),t=>new Me(void 0,{cause:J(t)}))};var xt=(r=1)=>r===0?yt():wt(),Pr=(r,e)=>e===0?gt(r):Et(r);var nr=class extends q{constructor(){super(...arguments);m(this,"message","An error occured while dealing with a file")}};var ir=class extends nr{constructor(){super(...arguments);m(this,"message","An error occured while operating on a file")}};var or=class extends ir{constructor(){super(...arguments);m(this,"message","An error occured while slicing a file")}};var At={},Cn=function(r,e,t,n,i){var o=new Worker(At[e]||(At[e]=URL.createObjectURL(new Blob([r+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(s){var a=s.data,f=a.$e$;if(f){var c=new Error(f[0]);c.code=f[1],c.stack=f[2],i(c,null)}else i(null,a)},o.postMessage(t,n),o},B=Uint8Array,ee=Uint16Array,We=Int32Array,ze=new B([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ie=new B([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),He=new B([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ot=function(r,e){for(var t=new ee(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new We(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Pt=Ot(ze,2),zr=Pt.b,cr=Pt.r;zr[28]=258,cr[258]=28;var kt=Ot(Ie,0),St=kt.b,Sr=kt.r,qe=new ee(32768);for(U=0;U<32768;++U)ye=(U&43690)>>1|(U&21845)<<1,ye=(ye&52428)>>2|(ye&13107)<<2,ye=(ye&61680)>>4|(ye&3855)<<4,qe[U]=((ye&65280)>>8|(ye&255)<<8)>>1;var ye,U,ue=function(r,e,t){for(var n=r.length,i=0,o=new ee(e);i<n;++i)r[i]&&++o[r[i]-1];var s=new ee(e);for(i=1;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var a;if(t){a=new ee(1<<e);var f=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],h=e-r[i],l=s[r[i]-1]++<<h,p=l|(1<<h)-1;l<=p;++l)a[qe[l]>>f]=c}else for(a=new ee(n),i=0;i<n;++i)r[i]&&(a[i]=qe[s[r[i]-1]++]>>15-r[i]);return a},ge=new B(288);for(U=0;U<144;++U)ge[U]=8;var U;for(U=144;U<256;++U)ge[U]=9;var U;for(U=256;U<280;++U)ge[U]=7;var U;for(U=280;U<288;++U)ge[U]=8;var U,Te=new B(32);for(U=0;U<32;++U)Te[U]=5;var U,Mt=ue(ge,9,0),Ut=ue(ge,9,1),Rt=ue(Te,5,0),Tt=ue(Te,5,1),ar=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ae=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},ur=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ze=function(r){return(r+7)/8|0},Le=function(r,e,t){return(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length),new B(r.subarray(e,t))};var zt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],W=function(r,e,t){var n=new Error(e||zt[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,W),!t)throw n;return n},It=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new B(0);var s=!t,a=s||e.i!=2,f=e.i;s&&(t=new B(i*3));var c=function(Y){var Be=t.length;if(Y>Be){var De=new B(Math.max(Be*2,Y));De.set(t),t=De}},h=e.f||0,l=e.p||0,p=e.b||0,v=e.l,x=e.d,g=e.m,y=e.n,D=i*8;do{if(!v){h=ae(r,l,1);var T=ae(r,l+1,3);if(l+=3,T)if(T==1)v=Ut,x=Tt,g=9,y=5;else if(T==2){var L=ae(r,l,31)+257,b=ae(r,l+10,15)+4,w=L+ae(r,l+5,31)+1;l+=14;for(var d=new B(w),k=new B(19),O=0;O<b;++O)k[He[O]]=ae(r,l+O*3,7);l+=b*3;for(var I=ar(k),V=(1<<I)-1,S=ue(k,I,1),O=0;O<w;){var P=S[ae(r,l,V)];l+=P&15;var C=P>>4;if(C<16)d[O++]=C;else{var j=0,M=0;for(C==16?(M=3+ae(r,l,3),l+=2,j=d[O-1]):C==17?(M=3+ae(r,l,7),l+=3):C==18&&(M=11+ae(r,l,127),l+=7);M--;)d[O++]=j}}var Z=d.subarray(0,L),G=d.subarray(L);g=ar(Z),y=ar(G),v=ue(Z,g,1),x=ue(G,y,1)}else W(1);else{var C=Ze(l)+4,E=r[C-4]|r[C-3]<<8,A=C+E;if(A>i){f&&W(0);break}a&&c(p+E),t.set(r.subarray(C,A),p),e.b=p+=E,e.p=l=A*8,e.f=h;continue}if(l>D){f&&W(0);break}}a&&c(p+131072);for(var de=(1<<g)-1,K=(1<<y)-1,te=l;;te=l){var j=v[ur(r,l)&de],Q=j>>4;if(l+=j&15,l>D){f&&W(0);break}if(j||W(2),Q<256)t[p++]=Q;else if(Q==256){te=l,v=null;break}else{var _=Q-254;if(Q>264){var O=Q-257,N=ze[O];_=ae(r,l,(1<<N)-1)+zr[O],l+=N}var re=x[ur(r,l)&K],ne=re>>4;re||W(3),l+=re&15;var G=St[ne];if(ne>3){var N=Ie[ne];G+=ur(r,l)&(1<<N)-1,l+=N}if(l>D){f&&W(0);break}a&&c(p+131072);var we=p+_;if(p<G){var Ae=o-G,F=Math.min(G,we);for(Ae+p<0&&W(3);p<F;++p)t[p]=n[Ae+p]}for(;p<we;++p)t[p]=t[p-G]}}e.l=v,e.p=te,e.b=p,e.f=h,v&&(h=1,e.m=g,e.d=x,e.n=y)}while(!h);return p!=t.length&&s?Le(t,0,p):t.subarray(0,p)},ve=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},Ue=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},fr=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,o=t.slice();if(!i)return{t:Fr,l:0};if(i==1){var s=new B(t[0].s+1);return s[t[0].s]=1,{t:s,l:1}}t.sort(function(A,L){return A.f-L.f}),t.push({s:-1,f:25001});var a=t[0],f=t[1],c=0,h=1,l=2;for(t[0]={s:-1,f:a.f+f.f,l:a,r:f};h!=i-1;)a=t[t[c].f<t[l].f?c++:l++],f=t[c!=h&&t[c].f<t[l].f?c++:l++],t[h++]={s:-1,f:a.f+f.f,l:a,r:f};for(var p=o[0].s,n=1;n<i;++n)o[n].s>p&&(p=o[n].s);var v=new ee(p+1),x=hr(t[h-1],v,0);if(x>e){var n=0,g=0,y=x-e,D=1<<y;for(o.sort(function(L,b){return v[b.s]-v[L.s]||L.f-b.f});n<i;++n){var T=o[n].s;if(v[T]>e)g+=D-(1<<x-v[T]),v[T]=e;else break}for(g>>=y;g>0;){var C=o[n].s;v[C]<e?g-=1<<e-v[C]++-1:++n}for(;n>=0&&g;--n){var E=o[n].s;v[E]==e&&(--v[E],++g)}x=e}return{t:new B(v),l:x}},hr=function(r,e,t){return r.s==-1?Math.max(hr(r.l,e,t+1),hr(r.r,e,t+1)):e[r.s]=t},Mr=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new ee(++e),n=0,i=r[0],o=1,s=function(f){t[n++]=f},a=1;a<=e;++a)if(r[a]==i&&a!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=r[a]}return{c:t.subarray(0,n),n:e}},Re=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},Ir=function(r,e,t){var n=t.length,i=Ze(e+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var o=0;o<n;++o)r[i+o+4]=t[o];return(i+4+n)*8},Ur=function(r,e,t,n,i,o,s,a,f,c,h){ve(e,h++,t),++i[256];for(var l=fr(i,15),p=l.t,v=l.l,x=fr(o,15),g=x.t,y=x.l,D=Mr(p),T=D.c,C=D.n,E=Mr(g),A=E.c,L=E.n,b=new ee(19),w=0;w<T.length;++w)++b[T[w]&31];for(var w=0;w<A.length;++w)++b[A[w]&31];for(var d=fr(b,7),k=d.t,O=d.l,I=19;I>4&&!k[He[I-1]];--I);var V=c+5<<3,S=Re(i,ge)+Re(o,Te)+s,P=Re(i,p)+Re(o,g)+s+14+3*I+Re(b,k)+2*b[16]+3*b[17]+7*b[18];if(f>=0&&V<=S&&V<=P)return Ir(e,h,r.subarray(f,f+c));var j,M,Z,G;if(ve(e,h,1+(P<S)),h+=2,P<S){j=ue(p,v,0),M=p,Z=ue(g,y,0),G=g;var de=ue(k,O,0);ve(e,h,C-257),ve(e,h+5,L-1),ve(e,h+10,I-4),h+=14;for(var w=0;w<I;++w)ve(e,h+3*w,k[He[w]]);h+=3*I;for(var K=[T,A],te=0;te<2;++te)for(var Q=K[te],w=0;w<Q.length;++w){var _=Q[w]&31;ve(e,h,de[_]),h+=k[_],_>15&&(ve(e,h,Q[w]>>5&127),h+=Q[w]>>12)}}else j=Mt,M=ge,Z=Rt,G=Te;for(var w=0;w<a;++w){var N=n[w];if(N>255){var _=N>>18&31;Ue(e,h,j[_+257]),h+=M[_+257],_>7&&(ve(e,h,N>>23&31),h+=ze[_]);var re=N&31;Ue(e,h,Z[re]),h+=G[re],re>3&&(Ue(e,h,N>>5&8191),h+=Ie[re])}else Ue(e,h,j[N]),h+=M[N]}return Ue(e,h,j[256]),h+M[256]},Ft=new We([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fr=new B(0),Bt=function(r,e,t,n,i,o){var s=o.z||r.length,a=new B(n+s+5*(1+Math.ceil(s/7e3))+i),f=a.subarray(n,a.length-i),c=o.l,h=(o.r||0)&7;if(e){h&&(f[0]=o.r>>3);for(var l=Ft[e-1],p=l>>13,v=l&8191,x=(1<<t)-1,g=o.p||new ee(32768),y=o.h||new ee(x+1),D=Math.ceil(t/3),T=2*D,C=function(Er){return(r[Er]^r[Er+1]<<D^r[Er+2]<<T)&x},E=new We(25e3),A=new ee(288),L=new ee(32),b=0,w=0,d=o.i||0,k=0,O=o.w||0,I=0;d+2<s;++d){var V=C(d),S=d&32767,P=y[V];if(g[S]=P,y[V]=S,O<=d){var j=s-d;if((b>7e3||k>24576)&&(j>423||!c)){h=Ur(r,f,0,E,A,L,w,k,I,d-I,h),k=b=w=0,I=d;for(var M=0;M<286;++M)A[M]=0;for(var M=0;M<30;++M)L[M]=0}var Z=2,G=0,de=v,K=S-P&32767;if(j>2&&V==C(d-K))for(var te=Math.min(p,j)-1,Q=Math.min(32767,d),_=Math.min(258,j);K<=Q&&--de&&S!=P;){if(r[d+Z]==r[d+Z-K]){for(var N=0;N<_&&r[d+N]==r[d+N-K];++N);if(N>Z){if(Z=N,G=K,N>te)break;for(var re=Math.min(K,N-2),ne=0,M=0;M<re;++M){var we=d-K+M&32767,Ae=g[we],F=we-Ae&32767;F>ne&&(ne=F,P=we)}}}S=P,P=g[S],K+=S-P&32767}if(G){E[k++]=268435456|cr[Z]<<18|Sr[G];var Y=cr[Z]&31,Be=Sr[G]&31;w+=ze[Y]+Ie[Be],++A[257+Y],++L[Be],O=d+Z,++b}else E[k++]=r[d],++A[r[d]]}}for(d=Math.max(d,O);d<s;++d)E[k++]=r[d],++A[r[d]];h=Ur(r,f,c,E,A,L,w,k,I,d-I,h),c||(o.r=h&7|f[h/8|0]<<3,h-=7,o.h=y,o.p=g,o.i=d,o.w=O)}else{for(var d=o.w||0;d<s+c;d+=65535){var De=d+65535;De>=s&&(f[h/8|0]=c,De=s),h=Ir(f,h+1,r.subarray(d,De))}o.i=s}return Le(a,0,n+Ze(h)+i)},On=function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&-306674912)^t>>>1;r[e]=t}return r}(),Pn=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=On[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}};var jt=function(r,e,t,n,i){if(!i&&(i={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),s=new B(o.length+r.length);s.set(o),s.set(r,o.length),r=s,i.w=o.length}return Bt(r,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,i)},Br=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},Lt=function(r,e,t){for(var n=r(),i=r.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),s=0;s<n.length;++s){var a=n[s],f=o[s];if(typeof a=="function"){e+=";"+f+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else{e+=c;for(var l in a.prototype)e+=";"+f+".prototype."+l+"="+a.prototype[l].toString()}else e+=c}else t[f]=a}return e},sr=[],kn=function(r){var e=[];for(var t in r)r[t].buffer&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},Sn=function(r,e,t,n){if(!sr[t]){for(var i="",o={},s=r.length-1,a=0;a<s;++a)i=Lt(r[a],i,o);sr[t]={c:Lt(r[s],i,o),e:o}}var f=Br({},sr[t].e);return Cn(sr[t].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,f,kn(f),n)},Mn=function(){return[B,ee,We,ze,Ie,He,zr,St,Ut,Tt,qe,zt,ue,ar,ae,ur,Ze,Le,W,It,_r,pr,_t]},Un=function(){return[B,ee,We,ze,Ie,He,cr,Sr,Mt,ge,Rt,Te,qe,Ft,Fr,ue,ve,Ue,fr,hr,Mr,Re,Ir,Ur,Ze,Le,Bt,jt,jr,pr]};var pr=function(r){return postMessage(r,[r.buffer])},_t=function(r){return r&&{out:r.size&&new B(r.size),dictionary:r.dictionary}},Nt=function(r,e,t,n,i,o){var s=Sn(t,n,i,function(a,f){s.terminate(),o(a,f)});return s.postMessage([r,e],e.consume?[r.buffer]:[]),function(){s.terminate()}};var me=function(r,e){return r[e]|r[e+1]<<8},he=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},kr=function(r,e){return he(r,e)+he(r,e+4)*4294967296},X=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8};function Rn(r,e,t){return t||(t=e,e={}),typeof t!="function"&&W(7),Nt(r,e,[Un],function(n){return pr(jr(n.data[0],n.data[1]))},0,t)}function jr(r,e){return jt(r,e||{},0,0)}function Tn(r,e,t){return t||(t=e,e={}),typeof t!="function"&&W(7),Nt(r,e,[Mn],function(n){return pr(_r(n.data[0],_t(n.data[1])))},1,t)}function _r(r,e){return It(r,{i:2},e&&e.out,e&&e.dictionary)}var Jt=function(r,e,t,n){for(var i in r){var o=r[i],s=e+i,a=n;Array.isArray(o)&&(a=Br(n,o[1]),o=o[0]),o instanceof B?t[s]=[o,a]:(t[s+="/"]=[new B(0),a],Jt(o,s,t,n))}},bt=typeof TextEncoder<"u"&&new TextEncoder,Rr=typeof TextDecoder<"u"&&new TextDecoder,zn=0;try{Rr.decode(Fr,{stream:!0}),zn=1}catch{}var In=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return{s:e,r:Le(r,t-1)};i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}};function Dt(r,e){if(e){for(var t=new B(r.length),n=0;n<r.length;++n)t[n]=r.charCodeAt(n);return t}if(bt)return bt.encode(r);for(var i=r.length,o=new B(r.length+(r.length>>1)),s=0,a=function(h){o[s++]=h},n=0;n<i;++n){if(s+5>o.length){var f=new B(s+8+(i-n<<1));f.set(o),o=f}var c=r.charCodeAt(n);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|r.charCodeAt(++n)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return Le(o,0,s)}function Fn(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(Rr)return Rr.decode(r);var i=In(r),o=i.s,t=i.r;return t.length&&W(8),o}}var Bn=function(r,e){return e+30+me(r,e+26)+me(r,e+28)},jn=function(r,e,t){var n=me(r,e+28),i=Fn(r.subarray(e+46,e+46+n),!(me(r,e+8)&2048)),o=e+46+n,s=he(r,e+20),a=t&&s==4294967295?_n(r,o):[s,he(r,e+24),he(r,e+42)],f=a[0],c=a[1],h=a[2];return[me(r,e+10),f,c,i,o+me(r,e+30)+me(r,e+32),h]},_n=function(r,e){for(;me(r,e)!=1;e+=4+me(r,e+2));return[kr(r,e+12),kr(r,e+4),kr(r,e+20)]},Tr=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;n>65535&&W(9),e+=n+4}return e},Ct=function(r,e,t,n,i,o,s,a){var f=n.length,c=t.extra,h=a&&a.length,l=Tr(c);X(r,e,s!=null?33639248:67324752),e+=4,s!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(o<0&&8),r[e++]=i&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var p=new Date(t.mtime==null?Date.now():t.mtime),v=p.getFullYear()-1980;if((v<0||v>119)&&W(10),X(r,e,v<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),e+=4,o!=-1&&(X(r,e,t.crc),X(r,e+4,o<0?-o-2:o),X(r,e+8,t.size)),X(r,e+12,f),X(r,e+14,l),e+=16,s!=null&&(X(r,e,h),X(r,e+6,t.attrs),X(r,e+10,s),e+=14),r.set(n,e),e+=f,l)for(var x in c){var g=c[x],y=g.length;X(r,e,+x),X(r,e+2,y),r.set(g,e+4),e+=4+y}return h&&(r.set(a,e),e+=h),e},Nn=function(r,e,t,n,i){X(r,e,101010256),X(r,e+8,t),X(r,e+10,t),X(r,e+12,n),X(r,e+16,i)};function Gt(r,e,t){t||(t=e,e={}),typeof t!="function"&&W(7);var n={};Jt(r,"",n,e);var i=Object.keys(n),o=i.length,s=0,a=0,f=o,c=new Array(o),h=[],l=function(){for(var y=0;y<h.length;++y)h[y]()},p=function(y,D){lr(function(){t(y,D)})};lr(function(){p=t});var v=function(){var y=new B(a+22),D=s,T=a-s;a=0;for(var C=0;C<f;++C){var E=c[C];try{var A=E.c.length;Ct(y,a,E,E.f,E.u,A);var L=30+E.f.length+Tr(E.extra),b=a+L;y.set(E.c,b),Ct(y,s,E,E.f,E.u,A,a,E.m),s+=16+L+(E.m?E.m.length:0),a=b+A}catch(w){return p(w,null)}}Nn(y,s,c.length,T,D),p(null,y)};o||v();for(var x=function(y){var D=i[y],T=n[D],C=T[0],E=T[1],A=Pn(),L=C.length;A.p(C);var b=Dt(D),w=b.length,d=E.comment,k=d&&Dt(d),O=k&&k.length,I=Tr(E.extra),V=E.level==0?0:8,S=function(P,j){if(P)l(),p(P,null);else{var M=j.length;c[y]=Br(E,{size:L,crc:A.d(),c:j,f:b,m:k,u:w!=D.length||k&&d.length!=O,compression:V}),s+=30+w+I+M,a+=76+2*(w+I)+(O||0)+M,--o||v()}};if(w>65535&&S(W(11,0,1),null),!V)S(null,C);else if(L<16e4)try{S(null,jr(C,E))}catch(P){S(P,null)}else h.push(Rn(C,E,S))},g=0;g<f;++g)x(g);return l}var lr=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(r){r()};function Ht(r,e,t){t||(t=e,e={}),typeof t!="function"&&W(7);var n=[],i=function(){for(var y=0;y<n.length;++y)n[y]()},o={},s=function(y,D){lr(function(){t(y,D)})};lr(function(){s=t});for(var a=r.length-22;he(r,a)!=101010256;--a)if(!a||r.length-a>65558)return s(W(13,0,1),null),i;var f=me(r,a+8);if(f){var c=f,h=he(r,a+16),l=h==4294967295||c==65535;if(l){var p=he(r,a-12);l=he(r,p)==101075792,l&&(c=f=he(r,p+32),h=he(r,p+48))}for(var v=e&&e.filter,x=function(y){var D=jn(r,h,l),T=D[0],C=D[1],E=D[2],A=D[3],L=D[4],b=D[5],w=Bn(r,b);h=L;var d=function(O,I){O?(i(),s(O,null)):(I&&(o[A]=I),--f||s(null,o))};if(!v||v({name:A,size:C,originalSize:E,compression:T}))if(!T)d(null,Le(r,w,w+C));else if(T==8){var k=r.subarray(w,w+C);if(E<524288||C>.8*E)try{d(null,_r(k,{out:new B(E)}))}catch(O){d(O,null)}else n.push(Tn(k,{size:E},d))}else d(W(14,"unknown compression type "+T,1),null);else d(null,null)},g=0;g<c;++g)x(g)}else s(null,{});return i}var Fe=class extends q{};var vr=class extends Fe{constructor(){super(...arguments);m(this,"message","An error occured while trying to compress the data")}};var mr=class extends Fe{constructor(){super(...arguments);m(this,"message","An error occured while trying to decompress the data")}};var dr=class extends q{constructor(){super(...arguments);m(this,"message","An error occured while downloading the data")}};var yr=class extends q{constructor(){super(...arguments);m(this,"message","An error occured while trying to retrieve server informations")}};var fe=class extends q{};var gr=class extends fe{constructor(){super(...arguments);m(this,"message","An error occured while trying to pause the job")}};var wr=class extends fe{constructor(){super(...arguments);m(this,"message","An error occured while trying to resume the job")}};var $e=class extends q{constructor(){super(...arguments);m(this,"message","An error occured while uploading the data")}};var Jn=15e5,be={},Jr=new qt.default,Gn=r=>{r.terminate();let e=new xe(r.lufiFile);return R.fromPromise(new Promise((t,n)=>{e.onMessage(i=>{i.data.event==="UPLOAD_CANCELLED"&&(be[e.lufiFile.keys.client].uploadStatus=0,t(e)),i.data.event==="OPERATION_FAILED"&&n(new fe("An error occured while trying to cancel an upload",{cause:i.data.error}))}).requestMessage({action:2,args:{lufiFile:e.lufiFile}})}),t=>J(t))},Wt=(r,e={})=>{let t=async n=>{var i;for(let o of n){let s=((i=o.name.split("/"))==null?void 0:i.pop())||o.name,a=s.split(".").shift(),f=s.split(".").pop(),c=s;if(e[c]!==void 0){let h=1;do c=`${a}_(${h}).${f}`,h++;while(e[c]!==void 0)}Jr.emit("ARCHIVE_ADDED_FILE",{name:c,size:o.size}),e[c]=await o.bytes()}};return R.fromPromise(t(r),n=>J(n)).andThen(()=>$(e))},Zt=(r,e)=>{let t=()=>new Promise((n,i)=>{Gt(r,(o,s)=>{o&&i(o),n(s)})});return R.fromPromise(t(),n=>n).andThen(n=>{try{return $(new File([new Blob([n])],e,{type:"application/zip"}))}catch(i){return H(i)}}).orElse(n=>H(new vr(void 0,{cause:J(n)})))},Hn=r=>{let e=async()=>{let t=await r.bytes();return new Promise((n,i)=>{Ht(t,(o,s)=>{o&&i(o),n(s)})})};return R.fromPromise(e(),t=>t).andThen(t=>{try{let n=[];for(let i in t)n.push(new File([new Blob([t[i]])],i));return $(n)}catch(n){return H(n)}}).orElse(t=>H(new mr(void 0,{cause:J(t)})))},$t=(r,e)=>e?at(r).andThen(t=>{if(t.version.tag>"0.07.0"){let n=Dr()?1:0;return Pr(e,n).andThen(i=>$(Ee.fromDownloadUrl(r,i)))}else return $(Ee.fromDownloadUrl(r,e))}):$(Ee.fromDownloadUrl(r)),qn=(r,e)=>$t(r,e).andThen(t=>{let n=new xe(t);return R.fromPromise(new Promise((i,o)=>n.onMessage(s=>{Kt(i,o,n,s),s.data.event==="CHUNK_DOWNLOADED"&&(n.tmpChunks[s.data.chunk.index]=new Blob([s.data.chunk.buffer])),s.data.event==="DOWNLOAD_COMPLETE"&&(n.tmpFile=new Blob(n.tmpChunks,{type:t.type}),n.tmpChunks=[],n.complete())}).requestMessage({action:3,args:{lufiFile:t}})),i=>new dr(void 0,{cause:J(i)}))}),Wn=(r,e)=>$t(r,e).andThen(t=>$(new xe(t))).andThen(t=>R.fromPromise(new Promise((n,i)=>{t.onMessage(o=>{o.data.event==="INFOS_RETRIEVED"&&(t.complete(),n(t)),o.data.event==="OPERATION_FAILED"&&i(new fe("An error occured while trying to retrieve informations of the file",{cause:o.data.error}))}).requestMessage({action:4,args:{lufiFile:t.lufiFile}})}),n=>new yr(void 0,{cause:J(n)}))),Zn=r=>{try{return r.status=3,$(r.requestMessage({action:5,args:{lufiFile:r.lufiFile}}))}catch(e){return H(new gr(void 0,{cause:J(e)}))}},$n=(r,e)=>{let t=Ee.fromRemoveUrl(r,e),n=new xe(t);return R.fromPromise(new Promise((i,o)=>{n.onMessage(s=>{s.data.event==="FILE_REMOVED"&&(n.complete(),i(n)),s.data.event==="OPERATION_FAILED"&&o(new fe("An error occured while trying to remove a file",{cause:s.data.error()}))}).requestMessage({action:7,args:{lufiFile:t}})}),i=>J(i))},Kn=r=>{try{return r.status=2,$(r.requestMessage({action:8,args:{lufiFile:r.lufiFile}}))}catch(e){return H(new wr(void 0,{cause:J(e)}))}},Vn=(r,e,t=Jn)=>{let n=Math.ceil(r.size/t);if(be[e].totalChunks=n,n>0){let i=[];for(let o=0;o<n;o++){let s=o*t,a=Math.min(s+t,r.size);i.push(r.slice(s,a,r.type))}return pe(i)}else return se(new or)},Yn=(r,e,t=0,n=!1,i=!1,o="documents.zip",s="",a=1)=>{let f=[];return i?e.length===1&&e[0].type==="application/zip"?f.push(Nr(r,e[0],t,n,i,s,a)):f.push(Wt(e).andThen(c=>Zt(c,o).andThen(h=>(Jr.emit("ARCHIVE_CREATED",h),Nr(r,h,t,n,i,s,a))))):e.forEach(c=>{f.push(Nr(r,c,t,n,i,s,a))}),R.combine(f).orElse(c=>H(new $e(void 0,{cause:c})))},Nr=(r,e,t,n,i,o,s)=>xt(s).andThen(a=>o?Pr(o,s).andThen(f=>$({password:f,clientKey:a})):$({password:o,clientKey:a})).andThen(({password:a,clientKey:f})=>{be[f]=new Ee(r.toString(),{delay:t,delAtFirstView:n,zipped:i,password:a,name:e.name.split("/").pop(),size:e.size,type:e.type,keys:{client:f,server:""}});let c=new xe(be[f]);return Vn(e,f).asyncAndThen(h=>{be[f].uploadStatus=4;let l=new Promise((v,x)=>{c.onMessage(g=>{switch(Kt(v,x,c,g),g.data.event){case"UPLOAD_COMPLETE":c.complete(),c.lufiFile.uploadStatus=1;break}})}),p=async v=>{for(let[x,g]of v.entries()){let y=await g.arrayBuffer();c.requestMessage({action:9,args:{chunk:{buffer:y,index:x},lufiFile:be[f],algo:s}},[y])}};return R.fromPromise(p(h),v=>new fe("An error occurred while sending chunks",{cause:J(v)})).andThen(()=>R.fromPromise(l,v=>J(v)))}).orElse(h=>H(new $e("An error occured while uploading a file",{cause:h})))}),Kt=(r,e,t,n)=>{n.data.event==="SOCKET_OPENED"&&r(t),n.data.event==="OPERATION_FAILED"&&e(new fe("The job returned an error",{cause:n.data.error}))},Xn=()=>Object.values(be).filter(r=>r.uploadStatus===4),Qn=r=>Object.keys(Xn()).indexOf(r);export{Pe as CryptoAlgorithm,R as ResultAsync,se as err,H as errAsync,Dr as isSecureContext,Gr as lufi,pe as ok,$ as okAsync};
